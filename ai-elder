#!/usr/bin/env python3
"""
AI Elder çµ±åˆã‚³ãƒãƒ³ãƒ‰
ã‚¨ãƒ«ãƒ€ãƒ¼ã‚ºé–¢é€£ã®ã™ã¹ã¦ã®æ©Ÿèƒ½ã‚’çµ±åˆã—ãŸçµ±ä¸€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
"""

import sys
import argparse
import subprocess
from pathlib import Path

PROJECT_ROOT = Path(__file__).parent.resolve()
# Check if running from scripts directory and adjust
if PROJECT_ROOT.name == "scripts":
    PROJECT_ROOT = PROJECT_ROOT.parent

def run_command(cmd):
    """ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦çµæœã‚’è¿”ã™"""
    try:
        result = subprocess.run(cmd, shell=True, capture_output=True, text=True, cwd=PROJECT_ROOT)
        if result.stdout:
            print(result.stdout)
        if result.stderr:
            print(result.stderr, file=sys.stderr)
        return result.returncode == 0
    except Exception as e:
        print(f"âŒ ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œã‚¨ãƒ©ãƒ¼: {e}", file=sys.stderr)
        return False

def show_status():
    """å…¨ä½“ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º"""
    print("ğŸ›ï¸ AI Elder ã‚·ã‚¹ãƒ†ãƒ çµ±åˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹")
    print("=" * 50)
    
    print("\nğŸ“Š ã‚¨ãƒ«ãƒ€ãƒ¼è©•è­°ä¼š:")
    run_command("./commands/ai_elder_council.py status")
    
    print("\nğŸ“‹ PMçµ±åˆçŠ¶æ³:")
    run_command("./commands/ai_elder_pm.py list")

def council_command(args):
    """ã‚¨ãƒ«ãƒ€ãƒ¼è©•è­°ä¼šé–¢é€£ã‚³ãƒãƒ³ãƒ‰"""
    cmd_map = {
        'status': './commands/ai_elder_council.py status',
        'triggers': './commands/ai_elder_council.py triggers',
        'councils': './commands/ai_elder_council.py councils',
        'metrics': './commands/ai_elder_council.py metrics',
        'start': './commands/ai_elder_council.py start --daemon',
        'simulate': './commands/ai_elder_council.py simulate'
    }
    
    if not args or args[0] not in cmd_map:
        print("ğŸ“‹ åˆ©ç”¨å¯èƒ½ãªcouncilã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰:")
        for cmd in cmd_map.keys():
            print(f"  - {cmd}")
        return
    
    run_command(cmd_map[args[0]])

def pm_command(args):
    """PMçµ±åˆã‚³ãƒãƒ³ãƒ‰"""
    cmd_map = {
        'list': './commands/ai_elder_pm.py list',
        'approve': './commands/ai_elder_pm.py approve',
        'reject': './commands/ai_elder_pm.py reject',
        'council': './commands/ai_elder_pm.py council',
        'monitor': './commands/ai_elder_pm.py monitor'
    }
    
    if not args or args[0] not in cmd_map:
        print("ğŸ“‹ åˆ©ç”¨å¯èƒ½ãªpmã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰:")
        for cmd in cmd_map.keys():
            print(f"  - {cmd}")
        return
    
    # å¼•æ•°ãŒã‚ã‚‹å ´åˆã¯æ¸¡ã™
    cmd = cmd_map[args[0]]
    if len(args) > 1:
        cmd += " " + " ".join(args[1:])
    
    run_command(cmd)

def cc_command(args):
    """ClaudeCodeç”¨å®Œå…¨ã‚·ã‚¹ãƒ†ãƒ æä¾›ã‚³ãƒãƒ³ãƒ‰"""
    if not args:
        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: å®Œå…¨ã‚·ã‚¹ãƒ†ãƒ æä¾›ï¼ˆãƒŠãƒ¬ãƒƒã‚¸ + ã‚¨ãƒ«ãƒ€ãƒ¼ã‚ºçŸ¥è­˜ï¼‰
        run_command("./ai-elder-start")
        print("\nğŸ¯ ClaudeCodeå®Œå…¨ã‚·ã‚¹ãƒ†ãƒ æä¾›å®Œäº†ï¼")
        print("ğŸ’¡ AI Companyã®å…¨çŸ¥è­˜ãŒæä¾›ã•ã‚Œã¾ã—ãŸ")
    elif args[0] == 'summary':
        # ã‚¨ãƒ«ãƒ€ãƒ¼ã‚ºã‚µãƒãƒªãƒ¼ã®ã¿
        run_command("./ai-elder-start --summary")
    elif args[0] == 'knowledge':
        # ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ã®ã¿
        run_command("./ai-elder-start --knowledge")
    elif args[0] == 'status':
        # ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ³ã®ã¿
        run_command("./ai-elder-start --status")
    elif args[0] == 'greet':
        # ã‚¨ãƒ«ãƒ€ãƒ¼ã‚ºæŒ¨æ‹¶ã®ã¿
        run_command("./ai-elder-start --greet")
    elif args[0] == 'help':
        # ãƒ˜ãƒ«ãƒ—è¡¨ç¤º
        run_command("./ai-elder-start --help")
    else:
        print("ğŸ“‹ åˆ©ç”¨å¯èƒ½ãªccã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰:")
        print("  - (ãªã—): å®Œå…¨ã‚·ã‚¹ãƒ†ãƒ æä¾›")
        print("  - summary: ã‚¨ãƒ«ãƒ€ãƒ¼ã‚ºã‚µãƒãƒªãƒ¼ã®ã¿")
        print("  - knowledge: ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ã®ã¿")
        print("  - status: ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ³ç¢ºèªã®ã¿")
        print("  - greet: ã‚¨ãƒ«ãƒ€ãƒ¼ã‚ºæŒ¨æ‹¶ã®ã¿")
        print("  - help: è©³ç´°ãƒ˜ãƒ«ãƒ—è¡¨ç¤º")

def knights_command(args):
    """é¨å£«å›£é–¢é€£ã‚³ãƒãƒ³ãƒ‰"""
    cmd_map = {
        'status': './commands/ai_incident_knights.py status',
        'plan': './commands/ai_incident_knights.py plan',
        'pm': './commands/ai_incident_knights.py pm',
        'sages': './commands/ai_incident_knights.py sages',
        'metrics': './commands/ai_incident_knights.py metrics'
    }
    
    if not args or args[0] not in cmd_map:
        print("ğŸ“‹ åˆ©ç”¨å¯èƒ½ãªknightsã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰:")
        for cmd in cmd_map.keys():
            print(f"  - {cmd}")
        return
    
    run_command(cmd_map[args[0]])

def servant_command(args):
    """Elder Servantç›´æ¥ã‚¿ã‚¹ã‚¯å‰²ã‚Šå½“ã¦ã‚³ãƒãƒ³ãƒ‰"""
    if not args:
        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ã‚µãƒ¼ãƒãƒ³ãƒˆä¸€è¦§è¡¨ç¤º
        run_command("ai-servant list")
        return
    
    # ai-servantã‚³ãƒãƒ³ãƒ‰ã«å¼•æ•°ã‚’æ¸¡ã™
    cmd = "ai-servant " + " ".join(args)
    run_command(cmd)

def show_help():
    """ãƒ˜ãƒ«ãƒ—è¡¨ç¤º"""
    help_text = """
ğŸ›ï¸ AI Elder çµ±åˆã‚³ãƒãƒ³ãƒ‰

ä½¿ç”¨æ–¹æ³•:
  ai-elder <subcommand> [options]

ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰:
  status              å…¨ä½“ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
  council <action>    ã‚¨ãƒ«ãƒ€ãƒ¼è©•è­°ä¼šç®¡ç†
  pm <action>         PMçµ±åˆç®¡ç†
  cc [option]         ClaudeCodeç”¨å®Œå…¨ã‚·ã‚¹ãƒ†ãƒ æä¾›
  knights <action>    é¨å£«å›£ç®¡ç†
  servant <action>    Elder Servantç›´æ¥ã‚¿ã‚¹ã‚¯å‰²ã‚Šå½“ã¦
  approval <action>   ã‚°ãƒ©ãƒ³ãƒ‰ã‚¨ãƒ«ãƒ€ãƒ¼ã¸ã®æ‰¿èªç”³è«‹ [NEW]
  summon <sage>       4è³¢è€…å¬å–š [NEW]
  emergency <action>  ç·Šæ€¥æ™‚å¯¾å¿œ [NEW]
  help               ã“ã®ãƒ˜ãƒ«ãƒ—ã‚’è¡¨ç¤º

è©³ç´°:
  ai-elder council status     è©•è­°ä¼šçŠ¶æ³ç¢ºèª
  ai-elder pm list           æ‰¿èªå¾…ã¡ãƒªã‚¹ãƒˆ
  ai-elder cc                å®Œå…¨ã‚·ã‚¹ãƒ†ãƒ æä¾›ï¼ˆæ¨å¥¨ï¼‰
  ai-elder cc summary        ã‚¨ãƒ«ãƒ€ãƒ¼ã‚ºã‚µãƒãƒªãƒ¼ã®ã¿
  ai-elder cc knowledge      ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ã®ã¿
  ai-elder cc status         ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ³ç¢ºèªã®ã¿
  ai-elder cc greet          ã‚¨ãƒ«ãƒ€ãƒ¼ã‚ºæŒ¨æ‹¶ã®ã¿
  ai-elder knights status    é¨å£«å›£çŠ¶æ³ç¢ºèª
  ai-elder servant list      Elder Servantä¸€è¦§
  
æ–°æ©Ÿèƒ½:
  ai-elder approval new      ã‚°ãƒ©ãƒ³ãƒ‰ã‚¨ãƒ«ãƒ€ãƒ¼ã¸ã®æ‰¿èªç”³è«‹ä½œæˆ
  ai-elder approval list     ä¿ç•™ä¸­ã®æ‰¿èªç”³è«‹ä¸€è¦§
  ai-elder summon all        4è³¢è€…ä¼šè­°å¬é›†
  ai-elder summon incident   ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆè³¢è€…å¬å–š
  ai-elder emergency check   ã‚·ã‚¹ãƒ†ãƒ å¥åº·è¨ºæ–­
  ai-elder emergency council ç·Šæ€¥è©•è­°ä¼šå¬é›†

ä¾‹:
  ai-elder status            # å…¨ä½“çŠ¶æ³ç¢ºèª
  ai-elder council triggers  # ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒˆãƒªã‚¬ãƒ¼ç¢ºèª
  ai-elder cc                # ClaudeCodeç”¨å®Œå…¨ã‚·ã‚¹ãƒ†ãƒ æä¾›ï¼ˆæ¨å¥¨ï¼‰
  ai-elder approval new --type system_change --title "æ–°æ©Ÿèƒ½è¿½åŠ "
  ai-elder summon incident -q "ã‚³ãƒ¼ãƒ‰å®Ÿè£…å‰ã®ãƒªã‚¹ã‚¯ç¢ºèª"
  ai-elder emergency check   # ã‚·ã‚¹ãƒ†ãƒ å¥åº·è¨ºæ–­
"""
    print(help_text)

def approval_command(args):
    """æ‰¿èªç”³è«‹ã‚³ãƒãƒ³ãƒ‰"""
    cmd = "bin/ai-elder-approval"
    if args:
        cmd += " " + " ".join(args)
    run_command(cmd)

def summon_command(args):
    """4è³¢è€…å¬å–šã‚³ãƒãƒ³ãƒ‰"""
    cmd = "bin/ai-elder-summon"
    if args:
        cmd += " " + " ".join(args)
    run_command(cmd)

def emergency_command(args):
    """ç·Šæ€¥å¯¾å¿œã‚³ãƒãƒ³ãƒ‰"""
    cmd = "bin/ai-elder-emergency"
    if args:
        cmd += " " + " ".join(args)
    run_command(cmd)

def main():
    if len(sys.argv) < 2:
        show_help()
        return
    
    command = sys.argv[1]
    args = sys.argv[2:] if len(sys.argv) > 2 else []
    
    if command == 'status':
        show_status()
    elif command == 'council':
        council_command(args)
    elif command == 'pm':
        pm_command(args)
    elif command == 'cc':
        cc_command(args)
    elif command == 'knights':
        knights_command(args)
    elif command == 'servant':
        servant_command(args)
    elif command == 'approval':
        approval_command(args)
    elif command == 'summon':
        summon_command(args)
    elif command == 'emergency':
        emergency_command(args)
    elif command in ['help', '-h', '--help']:
        show_help()
    else:
        print(f"âŒ ä¸æ˜ãªã‚³ãƒãƒ³ãƒ‰: {command}")
        print("åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰: status, council, pm, cc, knights, servant, approval, summon, emergency, help")
        sys.exit(1)

if __name__ == "__main__":
    main()