# 📚 AI Elder 専用ナレッジ

## 🎯 プロジェクト概要
- **目的**: エルダーズギルドのCLIインターフェース提供
- **特徴**: エルダー階層を反映したコマンド体系、自動化重視
- **使用技術スタック**: Python 3.9+ + Click + AsyncIO + RabbitMQ
- **主要な設計判断**: 非同期処理、プラグイン可能アーキテクチャ

## 🛠️ 技術固有知識

### Python CLI開発
- **特有のパターン**:
  - BaseCommandクラス継承パターン
  - 非同期コマンド実行フレームワーク
  - エルダー権限チェックデコレータ

- **最適化手法**:
  - 遅延インポートによる起動高速化
  - コマンド結果のキャッシング
  - 並列実行最適化

- **トラブルシューティング**:
  - パス解決問題（PROJECT_ROOT設定）
  - 非同期デッドロック回避
  - シグナルハンドリング

### RabbitMQ統合
- **特有のパターン**:
  - ワーカー自動復旧メカニズム
  - メッセージ優先度管理
  - DLQ（Dead Letter Queue）処理

- **最適化手法**:
  - コネクションプーリング
  - メッセージバッチング
  - 適応的プリフェッチ

## 📋 プロジェクト固有のベストプラクティス

### コマンド実装規約
```python
# エルダーコマンドの基本構造
class ElderCommand(BaseCommand):
    """エルダーレベルのコマンド実装"""

    def __init__(self):
        super().__init__(
            name="elder-command",
            description="🏛️ エルダーレベルの機能"
        )

    @elder_permission_required
    async def execute(self, args):
        # エルダー権限チェック済み処理
        pass
```

### テストパターン
```python
# 非同期コマンドテスト
@pytest.mark.asyncio
async def test_elder_command():
    command = ElderCommand()
    result = await command.execute(["--option", "value"])
    assert result.status == "success"
```

### コマンド命名規則
- `ai-` プレフィックス: 一般コマンド
- `elder-` プレフィックス: エルダー権限コマンド
- `四賢者名-` プレフィックス: 賢者専用コマンド

## 🚨 よくある問題と解決策

### プロジェクト特有のエラー
1. **ImportError: commands.base_command**
   - 原因: PYTHONPATH未設定
   - 解決: PROJECT_ROOT設定の確認

2. **RabbitMQ接続エラー**
   - 原因: コンテナ起動順序
   - 解決: 再試行ロジック実装

3. **非同期タイムアウト**
   - 原因: イベントループブロッキング
   - 解決: asyncio.create_task使用

### パフォーマンス問題
- **コマンド起動遅延**
  - 動的インポート実装
  - プリコンパイル最適化

### セキュリティ考慮事項
- エルダー権限の階層的管理
- コマンド実行ログの記録
- 機密情報のマスキング

## 🔄 中央知識ベースとの連携

### 参照している共通パターン
- BaseCommand実装パターン
- エラーハンドリング標準
- 非同期処理ベストプラクティス

### 貢献した共通知識
- CLI権限管理システム
- 非同期コマンドフレームワーク
- ワーカー自動復旧パターン

### 同期状況
- 最終同期: 2025年7月11日
- 次回同期: 自動（毎週）
- 昇華待ち: 権限階層管理パターン

## 📈 メトリクス・統計

### コード品質
- テストカバレッジ: 92%
- 型ヒントカバレッジ: 100%
- Cyclomatic Complexity: 平均3.2

### パフォーマンス
- コマンド起動時間: <100ms
- 平均実行時間: 250ms
- メモリ使用量: 50MB以下

### 使用統計
- 日次実行コマンド数: 1,000+
- 最頻出コマンド: ai-send, ai-status
- エラー率: 0.1%以下

## 🎯 独自機能・工夫

### エルダー階層反映
```
グランドエルダー専用: elder-grand-*
エルダー権限: elder-*
4賢者連携: sage-*
一般: ai-*
```

### 自動補完システム
- Bash/Zsh対応
- コンテキスト認識補完
- 履歴ベース提案

### プラグインシステム
- カスタムコマンド追加
- 外部ツール統合
- 動的ロード対応

---

**最終更新**: 2025年7月11日
**管理者**: ナレッジ賢者 + CLIプロジェクトチーム
**次回レビュー**: 2025年7月18日
