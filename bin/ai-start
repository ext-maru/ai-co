#!/bin/bash

# オプション解析
START_WEB=false
while [[ $# -gt 0 ]]; do
    case $1 in
        --web)
            START_WEB=true
            shift
            ;;
        --help|-h)
            echo "AI Company 起動コマンド"
            echo ""
            echo "使用方法:"
            echo "  ai-start [オプション]"
            echo ""
            echo "オプション:"
            echo "  --web     Webダッシュボードも同時に起動"
            echo "  --help    このヘルプを表示"
            exit 0
            ;;
        *)
            echo "未知のオプション: $1"
            echo "ヘルプ: ai-start --help"
            exit 1
            ;;
    esac
done

echo "🏢 AI Company を起動中..."
cd /home/aicompany/ai_co
if tmux has-session -t ai_company 2>/dev/null; then
    echo "⚠️  既にAI Companyが起動しています"
    exit 0
fi

# ワーカーを起動
bash scripts/start_company.sh

# Webオプションが指定されている場合
if [ "$START_WEB" = true ]; then
    echo "🌐 Webダッシュボードを起動中..."
    tmux new-window -t ai_company -n "webui"
    tmux send-keys -t ai_company:webui "cd $PWD && source venv/bin/activate" C-m
    tmux send-keys -t ai_company:webui "python3 web/dashboard_server.py" C-m
    echo "✅ Webダッシュボード起動完了！"
    echo "🌐 アクセス: http://localhost:5555"
fi
