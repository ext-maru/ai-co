# Alertmanagerè¨­å®š
global:
  # å†é€ä¿¡å‰ã®å¾…æ©Ÿæ™‚é–“
  resolve_timeout: 5m
  
  # Slackè¨­å®šï¼ˆä¾‹ï¼‰
  # slack_api_url: 'YOUR_SLACK_WEBHOOK_URL'

# ã‚¢ãƒ©ãƒ¼ãƒˆãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®š
route:
  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å—ä¿¡è€…
  receiver: 'default-receiver'
  
  # ã‚°ãƒ«ãƒ¼ãƒ—åŒ–è¨­å®š
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  
  # å­ãƒ«ãƒ¼ãƒˆ
  routes:
    # Critical alerts - å³åº§ã«é€šçŸ¥
    - match:
        severity: critical
      receiver: 'critical-receiver'
      group_wait: 0s
      repeat_interval: 5m
    
    # 4è³¢è€…é–¢é€£ã‚¢ãƒ©ãƒ¼ãƒˆ
    - match_re:
        sage: (incident|task|knowledge|rag)
      receiver: 'four-sages-receiver'
      group_by: ['sage', 'alertname']
      
    # Elder Flowé–¢é€£ã‚¢ãƒ©ãƒ¼ãƒˆ
    - match:
        alertname: ElderFlow.*
      receiver: 'elder-flow-receiver'
      
    # ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆ
    - match_re:
        alertname: (High.*|Disk.*|Container.*)
      receiver: 'system-receiver'
      group_interval: 5m

# å—ä¿¡è€…è¨­å®š
receivers:
  - name: 'default-receiver'
    webhook_configs:
      - url: 'http://host.docker.internal:8888/alerts/default'
        send_resolved: true

  - name: 'critical-receiver'
    webhook_configs:
      - url: 'http://host.docker.internal:8888/alerts/critical'
        send_resolved: true
    # Slackã¸ã®é€šçŸ¥ï¼ˆè¨­å®šä¾‹ï¼‰
    # slack_configs:
    #   - channel: '#critical-alerts'
    #     title: 'ğŸš¨ Critical Alert'
    #     text: '{{ .GroupLabels.alertname }}: {{ .Annotations.summary }}'

  - name: 'four-sages-receiver'
    webhook_configs:
      - url: 'http://host.docker.internal:8888/alerts/four-sages'
        send_resolved: true

  - name: 'elder-flow-receiver'
    webhook_configs:
      - url: 'http://host.docker.internal:8888/alerts/elder-flow'
        send_resolved: true

  - name: 'system-receiver'
    webhook_configs:
      - url: 'http://host.docker.internal:8888/alerts/system'
        send_resolved: true

# æŠ‘åˆ¶ãƒ«ãƒ¼ãƒ«ï¼ˆé‡è¤‡ã‚¢ãƒ©ãƒ¼ãƒˆé˜²æ­¢ï¼‰
inhibit_rules:
  # ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ã‚¢ãƒ©ãƒ¼ãƒˆãŒç™ºç”Ÿã—ãŸã‚‰ã€åŒã˜ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®è­¦å‘Šã‚’æŠ‘åˆ¶
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'instance']
    
  # ã‚³ãƒ³ãƒ†ãƒŠãƒ€ã‚¦ãƒ³ã®å ´åˆã€ãã®ã‚³ãƒ³ãƒ†ãƒŠã®ä»–ã®ã‚¢ãƒ©ãƒ¼ãƒˆã‚’æŠ‘åˆ¶
  - source_match:
      alertname: 'ContainerDown'
    target_match_re:
      alertname: 'Container.*'
    equal: ['name']