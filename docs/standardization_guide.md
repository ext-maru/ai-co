# ğŸ“š Elders Guild è»½é‡æ¨™æº–åŒ–ã‚¬ã‚¤ãƒ‰

## ğŸ¯ æ¦‚è¦

Phase 1ã®è»½é‡æ¨™æº–åŒ–ã«ã‚ˆã‚Šã€ä»¥ä¸‹ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å°å…¥ã—ã¾ã—ãŸï¼š

1. **BaseWorker** - ã™ã¹ã¦ã®ãƒ¯ãƒ¼ã‚«ãƒ¼ã®åŸºåº•ã‚¯ãƒ©ã‚¹
2. **BaseManager** - ã™ã¹ã¦ã®ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®åŸºåº•ã‚¯ãƒ©ã‚¹
3. **common_utils** - å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°

## ğŸ—ï¸ æ–°ã—ã„æ§‹é€ 

```
ai_co/
â”œâ”€â”€ core/                    # ğŸ†• å…±é€šåŸºç›¤
â”‚   â”œâ”€â”€ __init__.py         # ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åˆæœŸåŒ–
â”‚   â”œâ”€â”€ base_worker.py      # ãƒ¯ãƒ¼ã‚«ãƒ¼åŸºåº•ã‚¯ãƒ©ã‚¹
â”‚   â”œâ”€â”€ base_manager.py     # ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼åŸºåº•ã‚¯ãƒ©ã‚¹
â”‚   â””â”€â”€ common_utils.py     # å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”œâ”€â”€ workers/                # æ—¢å­˜
â”œâ”€â”€ libs/                   # æ—¢å­˜
â””â”€â”€ ...
```

## ğŸ”„ ç§»è¡Œæ–¹æ³•

### 1. æ—¢å­˜ãƒ¯ãƒ¼ã‚«ãƒ¼ã®ç§»è¡Œ

**Before:**
```python
class TestWorker:
    def __init__(self):
        self.name = "test_worker"
        # æ‰‹å‹•ã§RabbitMQæ¥ç¶šã€ãƒ­ã‚°è¨­å®šãªã©
```

**After:**
```python
from core import BaseWorker

class TestWorker(BaseWorker):
    def __init__(self, worker_id="001"):
        super().__init__(
            worker_id=worker_id,
            worker_type="test",
            input_queue="test_queue",
            output_queue="test_results"
        )
    
    def process_message(self, message):
        # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯ã®ã¿ã«é›†ä¸­
        return {"processed": True}
```

### 2. æ—¢å­˜ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®ç§»è¡Œ

**Before:**
```python
class TaskHistoryDB:
    def __init__(self):
        # æ‰‹å‹•ã§DBæ¥ç¶šã€ãƒ­ã‚°è¨­å®šãªã©
```

**After:**
```python
from core import BaseManager

class TaskHistoryDB(BaseManager):
    def __init__(self):
        super().__init__(
            manager_name="TaskHistoryDB",
            db_path="task_history.db"
        )
    
    def setup_schema(self):
        # ã‚¹ã‚­ãƒ¼ãƒå®šç¾©
```

## ğŸ¯ ãƒ¡ãƒªãƒƒãƒˆ

### 1. **ã‚³ãƒ¼ãƒ‰ã®å‰Šæ¸›**
- å…±é€šå‡¦ç†ã®é‡è¤‡ã‚’æ’é™¤
- ãƒœã‚¤ãƒ©ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰ã®å‰Šæ¸›
- å„ã‚¯ãƒ©ã‚¹ã¯æœ¬è³ªçš„ãªãƒ­ã‚¸ãƒƒã‚¯ã«é›†ä¸­

### 2. **ä¿¡é ¼æ€§ã®å‘ä¸Š**
- çµ±ä¸€ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½
- ã‚°ãƒ¬ãƒ¼ã‚¹ãƒ•ãƒ«ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³

### 3. **ä¿å®ˆæ€§ã®å‘ä¸Š**
- ä¸€è²«æ€§ã®ã‚ã‚‹ã‚³ãƒ¼ãƒ‰æ§‹é€ 
- å…±é€šæ©Ÿèƒ½ã®ä¸€å…ƒç®¡ç†
- ãƒ‡ãƒãƒƒã‚°ãŒå®¹æ˜“

### 4. **è‡ªå·±é€²åŒ–ã¨ã®ç›¸æ€§**
- ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¯ãƒ©ã‚¹æ§‹é€ ã‚’ç¶­æŒ
- AIãŒç†è§£ã—ã‚„ã™ã„ãƒ‘ã‚¿ãƒ¼ãƒ³
- æŸ”è»Ÿãªæ‹¡å¼µãŒå¯èƒ½

## ğŸ“‹ ç§»è¡Œãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### å„ªå…ˆåº¦: é«˜
- [ ] TaskWorker â†’ BaseWorkerç¶™æ‰¿
- [ ] PMWorker â†’ BaseWorkerç¶™æ‰¿
- [ ] ResultWorker â†’ BaseWorkerç¶™æ‰¿

### å„ªå…ˆåº¦: ä¸­
- [ ] DialogTaskWorker â†’ BaseWorkerç¶™æ‰¿
- [ ] DialogPMWorker â†’ BaseWorkerç¶™æ‰¿
- [ ] TaskHistoryDB â†’ BaseManagerç¶™æ‰¿
- [ ] ConversationManager â†’ BaseManagerç¶™æ‰¿

### å„ªå…ˆåº¦: ä½
- [ ] ãã®ä»–ã®ãƒ¯ãƒ¼ã‚«ãƒ¼
- [ ] ãã®ä»–ã®ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼

## ğŸ› ï¸ å®Ÿè£…ã®ãƒ’ãƒ³ãƒˆ

### 1. æ®µéšçš„ãªç§»è¡Œ
```bash
# 1. æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä½œæˆ
cp workers/task_worker.py workers/task_worker_refactored.py

# 2. BaseWorkerã‚’ä½¿ã£ã¦æ›¸ãæ›ãˆ

# 3. ãƒ†ã‚¹ãƒˆ
python3 workers/task_worker_refactored.py

# 4. ç½®ãæ›ãˆ
mv workers/task_worker.py workers/task_worker.py.bak
mv workers/task_worker_refactored.py workers/task_worker.py
```

### 2. å…±é€šãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ´»ç”¨
```python
# ãƒ­ã‚°å‡ºåŠ›
self.logger.info("âœ… å‡¦ç†å®Œäº†")  # BaseWorkerã®loggerä½¿ç”¨

# ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
# BaseWorkerãŒè‡ªå‹•çš„ã«å‡¦ç†ã€å¿…è¦ã«å¿œã˜ã¦ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

# çµ±è¨ˆæƒ…å ±
def get_stats(self):
    stats = super().get_stats()  # åŸºæœ¬çµ±è¨ˆã‚’ç¶™æ‰¿
    stats['custom_metric'] = self.custom_value
    return stats
```

### 3. ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
```bash
# ã‚³ã‚¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆ
python3 scripts/test_core_components.py

# å€‹åˆ¥ãƒ¯ãƒ¼ã‚«ãƒ¼ã®ãƒ†ã‚¹ãƒˆ
python3 workers/test_worker_refactored.py --id test_001
```

## ğŸš€ ä»Šå¾Œã®å±•é–‹

### Phase 1.5ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- Pydanticã«ã‚ˆã‚‹è¨­å®šç®¡ç†
- ã‚ˆã‚Šé«˜åº¦ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†ã®çµ±ä¸€

### Phase 2ï¼ˆå°†æ¥ï¼‰
- éƒ¨åˆ†çš„ãªãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯å°å…¥
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- åˆ†æ•£å‡¦ç†ã®å¼·åŒ–

## ğŸ“ æ³¨æ„äº‹é …

1. **å¾Œæ–¹äº’æ›æ€§**
   - æ—¢å­˜ã®ã‚­ãƒ¥ãƒ¼åã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å½¢å¼ã¯å¤‰æ›´ã—ãªã„
   - æ®µéšçš„ã«ç§»è¡Œã—ã€ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®å®‰å®šæ€§ã‚’ä¿ã¤

2. **è‡ªå·±é€²åŒ–ã‚·ã‚¹ãƒ†ãƒ ã¨ã®æ•´åˆæ€§**
   - BaseWorkerã®process_messageãƒ¡ã‚½ãƒƒãƒ‰ã¯å¿…é ˆ
   - ãƒ•ã‚¡ã‚¤ãƒ«é…ç½®ãƒ«ãƒ¼ãƒ«ã¯å¤‰æ›´ã—ãªã„

3. **ã‚·ãƒ³ãƒ—ãƒ«ã•ã®ç¶­æŒ**
   - éåº¦ãªæŠ½è±¡åŒ–ã¯é¿ã‘ã‚‹
   - AIãŒç†è§£ãƒ»ç”Ÿæˆã—ã‚„ã™ã„æ§‹é€ ã‚’ä¿ã¤

## ğŸ‰ ã¾ã¨ã‚

ã“ã®è»½é‡æ¨™æº–åŒ–ã«ã‚ˆã‚Šã€Elders Guildã‚·ã‚¹ãƒ†ãƒ ã¯ï¼š
- ã‚ˆã‚Šä¿å®ˆã—ã‚„ã™ã
- ã‚ˆã‚Šä¿¡é ¼æ€§ãŒé«˜ã
- ã‚ˆã‚Šæ‹¡å¼µã—ã‚„ã™ã

ãªã‚Šã¾ã—ãŸã€‚è‡ªå·±é€²åŒ–ã‚·ã‚¹ãƒ†ãƒ ã¨ã®ç›¸æ€§ã‚‚è‰¯å¥½ã§ã€ä»Šå¾Œã®ç™ºå±•ã«å‘ã‘ãŸè‰¯ã„åŸºç›¤ãŒã§ãã¾ã—ãŸï¼
