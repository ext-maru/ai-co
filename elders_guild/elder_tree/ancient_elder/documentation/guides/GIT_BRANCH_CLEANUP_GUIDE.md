# 🧹 Git ブランチクリーンアップガイド

## 概要
エルダーズギルドプロジェクトでは、自動化システムにより多数のブランチが作成されます。
定期的なクリーンアップが必要なため、2つの専用スクリプトを用意しています。

## 🛠️ クリーンアップスクリプト

### 1. git-branch-cleanup.sh (通常版)
**安全で保守的なクリーンアップ**を実行します。

#### 機能
- ✅ **マージ済みブランチの削除**
  - mainにマージ済みのブランチのみ対象
  - 削除前に確認プロンプト表示
  - 安全な`git branch -d`コマンドを使用

- ✅ **リモート参照の同期**
  - GitHubで削除されたブランチの参照を削除
  - `git remote prune origin`を実行

- ✅ **古いブランチの確認**
  - 30日以上前のブランチを表示（削除はしない）
  - 手動確認を推奨

- ✅ **auto-fixブランチの確認**
  - 存在するauto-fixブランチを表示（削除はしない）

#### 使用方法
```bash
# インタラクティブモード（推奨）
./scripts/git-branch-cleanup.sh
```

### 2. git-branch-aggressive-cleanup.sh (積極版)
**より積極的なクリーンアップ**を実行します。

#### 機能
- 🔥 **詳細な分析**
  - auto-fix、feature、その他のブランチ数を表示
  - 各ブランチのコミット差分と最終更新日を表示

- 🔥 **削除オプション**
  1. 1週間以上前のauto-fixブランチを削除
  2. マージ済みブランチを削除
  3. 両方を一括削除
  4. キャンセル

- 🔥 **強制削除**
  - `git branch -D`を使用（マージ状態に関係なく削除）
  - `--force`オプションで確認なし実行可能

#### 使用方法
```bash
# インタラクティブモード
./scripts/git-branch-aggressive-cleanup.sh

# 強制モード（危険！確認なしで削除）
./scripts/git-branch-aggressive-cleanup.sh --force
```

## 📊 実行例

### 通常版の実行結果
```
🧹 Git Branch Cleanup Script - エルダーズギルド
================================================

📊 現在のブランチ総数: 97

🗑️  Step 1: マージ済みローカルブランチの削除
----------------------------------------------
マージ済みブランチ: 24 個
  auto-fix-issue-141
  auto-fix-issue-20
  ...

これらのブランチを削除しますか? (y/N): y
✅ マージ済みブランチを削除しました
```

### 積極版の実行結果
```
🔥 Git Branch Aggressive Cleanup Script - エルダーズギルド
==========================================================

📊 現在のブランチ数:
  - ローカル: 33
  - リモート: 34

📋 ブランチ分析
----------------------------------------------
auto-fixブランチ: 20
featureブランチ: 3
その他: 8

⚠️  削除を実行しますか？
  1) 1週間以上前のauto-fixブランチを削除
  2) マージ済みブランチを削除
  3) 両方削除
  4) キャンセル
選択 (1-4): 3
```

## 🎯 推奨される使用方法

### 定期メンテナンス（週1回）
```bash
# 安全なクリーンアップ
./scripts/git-branch-cleanup.sh
```

### 大量のブランチが溜まった場合
```bash
# 積極的なクリーンアップ
./scripts/git-branch-aggressive-cleanup.sh
```

### 自動化された運用
```bash
# crontabに追加（毎週日曜日の午前3時に実行）
0 3 * * 0 cd /home/aicompany/ai_co && ./scripts/git-branch-cleanup.sh --auto
```

## ⚠️ 注意事項

1. **積極版の使用時は注意**
   - 強制削除（`-D`）を使用するため、未マージの変更が失われる可能性
   - 実行前に重要なブランチをバックアップ推奨

2. **auto-fixブランチについて**
   - 自動イシュー処理システムが作成
   - PRが作成されていないものは基本的に削除可能

3. **featureブランチ**
   - 手動で作成された開発ブランチ
   - 削除前に必ず内容を確認

## 📈 効果測定

実際のクリーンアップ例：
- **Before**: 97ブランチ（ローカル33、リモート34）
- **After**: 47ブランチ（ローカル13、リモート34）
- **削減率**: 51.5%

## 🔧 トラブルシューティング

### ブランチが削除できない場合
```bash
# 現在のブランチから移動
git checkout main

# 強制削除
git branch -D <branch-name>
```

### リモートブランチの同期エラー
```bash
# リモート情報を更新
git fetch --all --prune
```

## 📚 関連ドキュメント
- [Git ワークフローガイド](../GIT_WORKFLOW_GUIDE.md)
- [エルダーズギルド開発ガイド](../../CLAUDE.md)

---
**最終更新**: 2025年1月20日
**作成者**: クロードエルダー（Claude Elder）