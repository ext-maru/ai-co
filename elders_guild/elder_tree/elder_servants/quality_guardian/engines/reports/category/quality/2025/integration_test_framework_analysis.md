# çµ±åˆãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯åˆ†æãƒ¬ãƒãƒ¼ãƒˆ

## ğŸ“Š åŸºæœ¬æƒ…å ±

- **ãƒ•ã‚¡ã‚¤ãƒ«**: `libs/integration_test_framework.py`
- **åˆ†ææ—¥**: 2025å¹´7æœˆ19æ—¥
- **ç·è¡Œæ•°**: 1,169è¡Œ
- **ã‚³ãƒ¡ãƒ³ãƒˆç‡**: ç´„10%

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

### ã‚¯ãƒ©ã‚¹æ§‹æˆ
```
IntegrationTestRunner    # ãƒ¡ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼
â”œâ”€â”€ run_service_tests()
â”œâ”€â”€ run_api_tests()
â”œâ”€â”€ run_database_tests()
â””â”€â”€ run_e2e_tests()

ServiceOrchestrator     # ã‚µãƒ¼ãƒ“ã‚¹ç®¡ç†
â”œâ”€â”€ start_services()
â”œâ”€â”€ stop_services()
â”œâ”€â”€ check_health()
â””â”€â”€ wait_for_readiness()

TestDataManager        # ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç®¡ç†
â”œâ”€â”€ generate_test_data()
â”œâ”€â”€ setup_test_db()
â”œâ”€â”€ cleanup_test_data()
â””â”€â”€ load_fixtures()

IntegrationReporter    # ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
â”œâ”€â”€ generate_report()
â”œâ”€â”€ export_junit()
â””â”€â”€ create_html_report()

EnvironmentManager     # ç’°å¢ƒç®¡ç†
â”œâ”€â”€ setup_environment()
â”œâ”€â”€ create_snapshot()
â”œâ”€â”€ restore_snapshot()
â””â”€â”€ cleanup_environment()

IntegrationTestPipeline # ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³çµ±åˆ
â”œâ”€â”€ setup_pipeline()
â”œâ”€â”€ execute_pipeline()
â””â”€â”€ teardown_pipeline()
```

## ğŸ“‹ æ©Ÿèƒ½è©³ç´°åˆ†æ

### 1. ã‚µãƒ¼ãƒ“ã‚¹çµ±åˆãƒ†ã‚¹ãƒˆ

#### å®Ÿè£…æ©Ÿèƒ½
- **ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯**: HTTP/gRPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆç›£è¦–
- **ä¾å­˜é–¢ä¿‚ç®¡ç†**: ã‚µãƒ¼ãƒ“ã‚¹é–“ä¾å­˜é–¢ä¿‚ã®æ¤œè¨¼
- **èµ·å‹•é †åºåˆ¶å¾¡**: dependency graphãƒ™ãƒ¼ã‚¹ã®èµ·å‹•
- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“æ¸¬å®š**: ç°¡æ˜“çš„ãªæ€§èƒ½æ¸¬å®š

#### ä¾å­˜é–¢ä¿‚è§£æ±º
```python
dependency_graph = self._build_dependency_graph(services)
# å„ã‚µãƒ¼ãƒ“ã‚¹ã®ä¾å­˜é–¢ä¿‚ã‚’ãƒã‚§ãƒƒã‚¯
deps_ok = all(
    results.get(dep, {}).get('status') == 'healthy'
    for dep in service_config.get('dependencies', [])
)
```

### 2. APIãƒ†ã‚¹ãƒˆ

#### ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½
- **å¤šæ®µéšAPIãƒ†ã‚¹ãƒˆ**: ã‚¹ãƒ†ãƒƒãƒ—ãƒ™ãƒ¼ã‚¹ã®å®Ÿè¡Œ
- **ãƒ‡ãƒ¼ã‚¿å…±æœ‰**: ã‚¹ãƒ†ãƒƒãƒ—é–“ã§ã®contextå…±æœ‰
- **ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³**: ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ¤œè¨¼
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: å¤±æ•—æ™‚ã®è©³ç´°ã‚¨ãƒ©ãƒ¼æƒ…å ±

#### å®Ÿè¡Œãƒ•ãƒ­ãƒ¼
1. å„ã‚¹ãƒ†ãƒƒãƒ—ã®é †æ¬¡å®Ÿè¡Œ
2. ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®contextä¿å­˜
3. ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
4. çµæœé›†è¨ˆ

### 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ

#### æ©Ÿèƒ½ç¯„å›²
- **æ¥ç¶šãƒ†ã‚¹ãƒˆ**: è¤‡æ•°DBã‚¨ãƒ³ã‚¸ãƒ³å¯¾å¿œ
- **ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´ãƒ†ã‚¹ãƒˆ
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: ã‚¯ã‚¨ãƒªå®Ÿè¡Œæ™‚é–“æ¸¬å®š
- **ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§**: ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³æ¤œè¨¼

### 4. ç’°å¢ƒç®¡ç†

#### æ©Ÿèƒ½æ¦‚è¦
- **Dockerã‚³ãƒ³ãƒ†ãƒŠ**: ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•/åœæ­¢
- **ãƒãƒ¼ãƒˆç®¡ç†**: å‹•çš„ãƒãƒ¼ãƒˆå‰²ã‚Šå½“ã¦
- **ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ**: ç’°å¢ƒçŠ¶æ…‹ã®ä¿å­˜/å¾©å…ƒ
- **ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**: ãƒ†ã‚¹ãƒˆå¾Œã®ç’°å¢ƒãƒªã‚»ãƒƒãƒˆ

### 5. ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

#### å‡ºåŠ›å½¢å¼
- **HTML**: ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ¬ãƒãƒ¼ãƒˆ
- **JUnit XML**: CI/CDçµ±åˆ
- **JSON**: æ©Ÿæ¢°å¯èª­å½¢å¼
- **ã‚«ã‚¹ã‚¿ãƒ **: Jinja2ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

## ğŸ” OSSä»£æ›¿å¯èƒ½æ€§åˆ†æ

### ç¾åœ¨ã®ç‹¬è‡ªå®Ÿè£… vs OSSä»£æ›¿

| æ©Ÿèƒ½ | ç¾åœ¨ã®å®Ÿè£… | OSSä»£æ›¿æ¡ˆ | ç§»è¡Œé›£æ˜“åº¦ |
|------|-----------|----------|----------|
| **ãƒ†ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼** | ç‹¬è‡ªãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ | **PyTest** | ä½ |
| **ã‚µãƒ¼ãƒ“ã‚¹ç®¡ç†** | ç‹¬è‡ªã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ | **Testcontainers** | ä½ |
| **API ãƒ†ã‚¹ãƒˆ** | ç‹¬è‡ªå®Ÿè£… | **PyTest + requests** | ä½ |
| **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹** | ç‹¬è‡ªDBæ¥ç¶š | **pytest-postgresql/mysql** | ä½ |
| **ç’°å¢ƒç®¡ç†** | ç‹¬è‡ªDockeråˆ¶å¾¡ | **Docker Compose + Testcontainers** | ä¸­ |
| **ãƒ¬ãƒãƒ¼ãƒˆ** | ç‹¬è‡ªHTMLç”Ÿæˆ | **pytest-html + allure** | ä½ |

## ğŸ’° ä¿å®ˆã‚³ã‚¹ãƒˆåˆ†æ

### ç¾åœ¨ã®ã‚³ã‚¹ãƒˆ
- **é–‹ç™ºå·¥æ•°**: ç´„30äººæ—¥ï¼ˆæ¨å®šï¼‰
- **ä¿å®ˆå·¥æ•°**: æœˆ4-5äººæ—¥
- **ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰**: 19ãƒ†ã‚¹ãƒˆï¼ˆtest_integration_test_framework.pyï¼‰
- **ãƒã‚°ä¿®æ­£**: æœˆ3-4ä»¶

### æŠ€è¡“çš„è² å‚µ
1. **ç’°å¢ƒåˆ†é›¢**: ä¸ååˆ†ãªãƒ†ã‚¹ãƒˆç’°å¢ƒåˆ†é›¢
2. **ä¸¦åˆ—å®Ÿè¡Œ**: åŸºæœ¬çš„ãªä¸¦åˆ—åŒ–ã®ã¿
3. **ã‚¨ãƒ©ãƒ¼å‡¦ç†**: è©³ç´°ãªã‚¨ãƒ©ãƒ¼åˆ†é¡ä¸è¶³
4. **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**: å¤§è¦æ¨¡ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã¸ã®å¯¾å¿œä¸è¶³
5. **CI/CDçµ±åˆ**: é™å®šçš„ãªçµ±åˆæ©Ÿèƒ½

## ğŸ“Š å“è³ªè©•ä¾¡

### é•·æ‰€
- âœ… åŒ…æ‹¬çš„ãªçµ±åˆãƒ†ã‚¹ãƒˆæ©Ÿèƒ½
- âœ… ã‚µãƒ¼ãƒ“ã‚¹ä¾å­˜é–¢ä¿‚ç®¡ç†
- âœ… å¤šå½¢å¼ãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›
- âœ… ç’°å¢ƒã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆæ©Ÿèƒ½

### çŸ­æ‰€
- âŒ ãƒ†ã‚¹ãƒˆåˆ†é›¢ã®ä¸å®Œå…¨æ€§
- âŒ å¤§è¦æ¨¡ä¸¦åˆ—å®Ÿè¡Œã®åˆ¶é™
- âŒ ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½ã®ä¸è¶³
- âŒ ãƒ¢ãƒƒã‚¯ã‚¢ãƒƒãƒ—æ©Ÿèƒ½ã®æ¬ å¦‚

## ğŸ¯ OSSç§»è¡Œæ¨å¥¨åº¦: â˜…â˜…â˜…â˜…â˜† (4/5)

### ç§»è¡Œãƒ¡ãƒªãƒƒãƒˆ
1. **ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ **: PyTestã®è±Šå¯Œãªãƒ—ãƒ©ã‚°ã‚¤ãƒ³
2. **ãƒ†ã‚¹ãƒˆåˆ†é›¢**: Testcontainersã«ã‚ˆã‚‹å®Œå…¨åˆ†é›¢
3. **CI/CDçµ±åˆ**: æ¥­ç•Œæ¨™æº–ãƒ„ãƒ¼ãƒ«ã¨ã®çµ±åˆ
4. **ã‚³ã‚¹ãƒˆå‰Šæ¸›**: é–‹ç™ºãƒ»ä¿å®ˆå·¥æ•°ã®60%å‰Šæ¸›è¦‹è¾¼ã¿

### ç§»è¡Œãƒªã‚¹ã‚¯
1. **è¨­å®šè¤‡é›‘æ€§**: Testcontainersè¨­å®šã®è¤‡é›‘ã•
2. **ãƒªã‚½ãƒ¼ã‚¹è¦ä»¶**: Dockerç’°å¢ƒã®ãƒªã‚½ãƒ¼ã‚¹æ¶ˆè²»
3. **å­¦ç¿’ã‚³ã‚¹ãƒˆ**: PyTestç”Ÿæ…‹ç³»ã®ç¿’å¾—

## ğŸ“‹ æ¨å¥¨OSSæ§‹æˆ

### Core Framework
```python
# PyTest + Testcontainers
import pytest
from testcontainers.postgres import PostgresContainer
from testcontainers.compose import DockerCompose

@pytest.fixture(scope="session")
def postgres_container():
    with PostgresContainer("postgres:13") as postgres:
        yield postgres

def test_database_integration(postgres_container):
    connection_url = postgres_container.get_connection_url()
    # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
```

### Supporting Tools
- **pytest-xdist**: ä¸¦åˆ—ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
- **pytest-html**: HTML ãƒ¬ãƒãƒ¼ãƒˆ
- **allure-pytest**: é«˜åº¦ãªãƒ¬ãƒãƒ¼ãƒˆ
- **pytest-mock**: ãƒ¢ãƒƒã‚¯æ©Ÿèƒ½

## ğŸ“ˆ ç§»è¡Œãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

### Phase 1: åŸºç›¤ç§»è¡Œ (Week 1-2)
- PyTestç’°å¢ƒæ§‹ç¯‰
- åŸºæœ¬çš„ãªãƒ†ã‚¹ãƒˆç§»è¡Œ
- Testcontainerså°å…¥

### Phase 2: æ©Ÿèƒ½ç§»è¡Œ (Week 3-4)
- ã‚µãƒ¼ãƒ“ã‚¹ãƒ†ã‚¹ãƒˆç§»è¡Œ
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆç§»è¡Œ
- ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½çµ±åˆ

### Phase 3: å®Œå…¨ç§»è¡Œ (Week 5-6)
- ä¸¦åˆ—å®Ÿè¡Œæœ€é©åŒ–
- CI/CDçµ±åˆ
- ç‹¬è‡ªå®Ÿè£…å»ƒæ­¢

## ğŸ”§ å…·ä½“çš„ç§»è¡Œä¾‹

### Before (ç¾åœ¨)
```python
runner = IntegrationTestRunner()
results = await runner.run_service_tests({
    'api': {'url': 'http://localhost:8000', 'dependencies': ['db']},
    'db': {'url': 'postgresql://localhost:5432/test'}
})
```

### After (PyTest + Testcontainers)
```python
@pytest.mark.integration
def test_service_integration(docker_compose_file):
    with DockerCompose(docker_compose_file) as compose:
        api_host = compose.get_service_host("api", 8000)
        db_host = compose.get_service_host("db", 5432)

        # APIãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        response = requests.get(f"http://{api_host}/health")
        assert response.status_code == 200
```

## ğŸ’¡ çµè«–

çµ±åˆãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¯ã€PyTest + Testcontainersã¸ã®ç§»è¡Œã«ã‚ˆã‚Š**å¤§å¹…ãªæ©Ÿèƒ½å‘ä¸Šã¨ä¿å®ˆæ€§æ”¹å–„**ãŒæœŸå¾…ã§ãã¾ã™ã€‚ç‰¹ã«ç’°å¢ƒåˆ†é›¢ã¨CI/CDçµ±åˆã«ãŠã„ã¦ã€ç¾åœ¨ã®åˆ¶é™ã‚’å¤§ããè¶…ãˆã‚‹æ¥­ç•Œæ¨™æº–ã®æ©Ÿèƒ½ã‚’å®Ÿç¾ã§ãã¾ã™ã€‚
