#!/usr/bin/env python3
"""
AI Elder Cast ãƒ†ã‚¹ãƒˆ - Claude Codeèµ·å‹•ãªã—ã§ãƒã‚§ãƒƒã‚¯
"""

import os
import subprocess
import sys
from pathlib import Path


def test_ai_elder_cast():
    """ai-elder-cast ã®ãƒ†ã‚¹ãƒˆ"""
    print("ğŸ§ª ai-elder-cast ãƒ†ã‚¹ãƒˆé–‹å§‹")

    project_root = Path(__file__).parent.parent
    medium_file = project_root / "docs" / "technical" / "ELDER_KNOWLEDGE_CONTEXT_MEDIUM.md"

    # ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨ãƒã‚§ãƒƒã‚¯
    if medium_file.exists():
        size = medium_file.stat().st_size
        print(f"âœ… ä¸­é–“ç‰ˆãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨: {medium_file.name} ({size/1024:.1f}KB)")
    else:
        print(f"âŒ ä¸­é–“ç‰ˆãƒ•ã‚¡ã‚¤ãƒ«ä¸å­˜åœ¨: {medium_file}")
        return False

    # Claude Codeæ¤œç´¢ãƒ†ã‚¹ãƒˆ
    claude_cmd = None
    for cmd in ["claude", "claude-cli", "claude-code"]:
        try:
            result = subprocess.run([cmd, "--version"], capture_output=True, check=True)
            claude_cmd = cmd
            print(f"âœ… Claude Codeç™ºè¦‹: {cmd}")
            break
        except (subprocess.CalledProcessError, FileNotFoundError):
            print(f"âš ï¸  Claude Codeæœªç™ºè¦‹: {cmd}")
            continue

    if not claude_cmd:
        print("âŒ Claude Code ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
        return False

    print("âœ… åŸºæœ¬ãƒ†ã‚¹ãƒˆå®Œäº†")
    return True


def test_ai_elder_cast_modular():
    """ai-elder-cast-modular ã®ãƒ†ã‚¹ãƒˆ"""
    print("\nğŸ§ª ai-elder-cast-modular ãƒ†ã‚¹ãƒˆé–‹å§‹")

    # --list ãƒ†ã‚¹ãƒˆ
    try:
        result = subprocess.run(
            ["python3", "scripts/ai-elder-cast-modular", "--list"],
            capture_output=True,
            text=True,
            timeout=10,
        )

        if result.returncode == 0:
            print("âœ… --list ã‚ªãƒ—ã‚·ãƒ§ãƒ³å‹•ä½œ")
            lines = result.stdout.count("\n")
            print(f"âœ… {lines}è¡Œã®å‡ºåŠ›")
        else:
            print(f"âŒ --list ã‚¨ãƒ©ãƒ¼: {result.stderr}")
            return False

    except subprocess.TimeoutExpired:
        print("âŒ --list ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ")
        return False

    print("âœ… ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆå®Œäº†")
    return True


def main():
    """ãƒ¡ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆ"""
    print("ğŸ”® AI Elder Cast å…¨ä½“ãƒ†ã‚¹ãƒˆ")
    print("=" * 50)

    test1 = test_ai_elder_cast()
    test2 = test_ai_elder_cast_modular()

    print("\nğŸ“Š ãƒ†ã‚¹ãƒˆçµæœ:")
    print(f"ai-elder-cast: {'âœ… æ­£å¸¸' if test1 else 'âŒ ç•°å¸¸'}")
    print(f"ai-elder-cast-modular: {'âœ… æ­£å¸¸' if test2 else 'âŒ ç•°å¸¸'}")

    if test1 and test2:
        print("\nğŸ‰ å…¨ãƒ†ã‚¹ãƒˆåˆæ ¼ï¼")
        return 0
    else:
        print("\nâš ï¸  ä¸€éƒ¨ãƒ†ã‚¹ãƒˆå¤±æ•—")
        return 1


if __name__ == "__main__":
    sys.exit(main())
