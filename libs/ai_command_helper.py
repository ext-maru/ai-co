#!/usr/bin/env python3
"""
AI Command Helper - ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œæ”¯æ´ãƒ„ãƒ¼ãƒ«
"""

import os
import subprocess
from pathlib import Path
import json
from datetime import datetime

class AICommandHelper:
    """AI Commandã‚·ã‚¹ãƒ†ãƒ ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚¯ãƒ©ã‚¹"""
    
    def __init__(self):
        self.commands_dir = Path('/home/aicompany/ai_co/ai_commands')
        self.commands_dir.mkdir(exist_ok=True)
        
    def create_bash_command(self, script_content, command_name):
        """bashã‚³ãƒãƒ³ãƒ‰ã‚’ä½œæˆ"""
        command_file = self.commands_dir / f"{command_name}.sh"
        
        # ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
        with open(command_file, 'w') as f:
            f.write("#!/bin/bash\n")
            f.write(f"# Auto-generated by AI Command Helper at {datetime.now()}\n\n")
            f.write(script_content)
        
        # å®Ÿè¡Œæ¨©é™ã‚’ä»˜ä¸
        os.chmod(command_file, 0o755)
        
        # ã‚³ãƒãƒ³ãƒ‰ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚’ç™»éŒ²
        alias_file = self.commands_dir / 'aliases.sh'
        with open(alias_file, 'a') as f:
            f.write(f"\nalias {command_name}='bash {command_file}'")
        
        print(f"âœ… ã‚³ãƒãƒ³ãƒ‰ '{command_name}' ã‚’ä½œæˆã—ã¾ã—ãŸ")
        print(f"   å®Ÿè¡Œ: {command_name}")
        
        return str(command_file)
    
    def execute_command(self, command_name):
        """ç™»éŒ²ã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œ"""
        command_file = self.commands_dir / f"{command_name}.sh"
        
        if not command_file.exists():
            print(f"âŒ ã‚³ãƒãƒ³ãƒ‰ '{command_name}' ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
            return False
        
        print(f"ğŸ”§ å®Ÿè¡Œä¸­: {command_name}")
        result = subprocess.run(['bash', str(command_file)], capture_output=True, text=True)
        
        if result.stdout:
            print(result.stdout)
        if result.stderr:
            print(f"âš ï¸ ã‚¨ãƒ©ãƒ¼: {result.stderr}")
        
        return result.returncode == 0
    
    def list_commands(self):
        """ç™»éŒ²ã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ä¸€è¦§ã‚’è¡¨ç¤º"""
        commands = list(self.commands_dir.glob('*.sh'))
        
        if not commands:
            print("ç™»éŒ²ã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ã¯ã‚ã‚Šã¾ã›ã‚“")
            return
        
        print("ğŸ“‹ ç™»éŒ²ã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰:")
        for cmd in commands:
            print(f"  - {cmd.stem}")
