# Enhanced Elder Servant Base Classes

Elder Treeåˆ†æ•£AIã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ç”¨ã®çµ±åˆåŸºåº•ã‚¯ãƒ©ã‚¹ç¾¤

## æ¦‚è¦

ã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ã€Elder Treeåˆ†æ•£AIã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ä¸­æ ¸ã‚’æˆã™32å°‚é–€AIã‚µãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…ã®ãŸã‚ã®çµ±åˆåŸºåº•ã‚¯ãƒ©ã‚¹ã‚’æä¾›ã—ã¾ã™ã€‚

## ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### 1. EnhancedElderServantï¼ˆçµ±åˆåŸºåº•ã‚¯ãƒ©ã‚¹ï¼‰

Elder Treeåˆ†æ•£å®Ÿè£…ã®è¦ä»¶ã‚’ã™ã¹ã¦æº€ãŸã™çµ±åˆåŸºåº•ã‚¯ãƒ©ã‚¹

**çµ±åˆæ©Ÿèƒ½:**
- âœ… EldersLegacyå“è³ªåŸºæº–ã¨ãƒ¡ãƒˆãƒªã‚¯ã‚¹
- âœ… BaseSoul A2Aé€šä¿¡ã¨ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†  
- âœ… 4è³¢è€…ã‚·ã‚¹ãƒ†ãƒ é€£æºã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- âœ… ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆé¨å£«å›£äºˆé˜²çš„ãƒ‡ãƒãƒƒã‚°
- âœ… åˆ†æ•£å‡¦ç†ãƒ»è² è·åˆ†æ•£ãƒ»ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
- âœ… Iron Willå“è³ªã‚²ãƒ¼ãƒˆè‡ªå‹•æ¤œè¨¼
- âœ… ç¶™ç¶šå­¦ç¿’ãƒ»è‡ªå‹•é€²åŒ–ã‚·ã‚¹ãƒ†ãƒ 
- âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ãƒ»ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†

### 2. å°‚é–€ç‰¹åŒ–ã‚µãƒ¼ãƒãƒ³ãƒˆåŸºåº•ã‚¯ãƒ©ã‚¹

#### DwarfWorkshopServantï¼ˆğŸ”¨ é–‹ç™ºãƒ»è£½ä½œï¼‰
- ã‚³ãƒ¼ãƒ‰å®Ÿè£…ãƒ»ç”Ÿæˆ
- ãƒ†ã‚¹ãƒˆä½œæˆãƒ»å®Ÿè¡Œ
- APIè¨­è¨ˆãƒ»é–‹ç™º
- ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãƒ»CI/CD

#### RAGWizardServantï¼ˆğŸ§™â€â™‚ï¸ èª¿æŸ»ãƒ»ç ”ç©¶ï¼‰
- ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ‹ãƒ³ã‚°ãƒ»åé›†
- æŠ€è¡“èª¿æŸ»ãƒ»ææ¡ˆ
- ãƒ‘ã‚¿ãƒ¼ãƒ³è§£æ
- æ´å¯Ÿç”Ÿæˆãƒ»äºˆæ¸¬

#### ElfForestServantï¼ˆğŸ§â€â™‚ï¸ ç›£è¦–ãƒ»ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ï¼‰
- å“è³ªç›£è¦–ãƒ»ä¿è¨¼
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ãƒ»æœ€é©åŒ–
- ãƒªã‚½ãƒ¼ã‚¹æœ€é©åŒ–ãƒ»ç®¡ç†
- è‡ªå‹•ä¿®å¾©ãƒ»ãƒ’ãƒ¼ãƒªãƒ³ã‚°

#### IncidentKnightServantï¼ˆâš”ï¸ ç·Šæ€¥å¯¾å¿œï¼‰
- ã‚³ãƒãƒ³ãƒ‰æ¤œè¨¼ãƒ»å®Ÿè¡Œå‰ãƒã‚§ãƒƒã‚¯
- é™çš„ãƒ»å‹•çš„è§£æ
- è‡ªå‹•ä¿®å¾©ãƒ»å•é¡Œè§£æ±º
- ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œ

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬çš„ãªä½¿ç”¨ä¾‹

```python
from libs.elder_servants.base.enhanced_elder_servant import (
    EnhancedElderServant,
    ServantSpecialization,
    ServantTier
)

class MyCustomServant(EnhancedElderServant[Dict[str, Any], Dict[str, Any]]):
    """ã‚«ã‚¹ã‚¿ãƒ ã‚µãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…ä¾‹"""
    
    def __init__(self):
        super().__init__(
            servant_id="my_servant_001",
            servant_name="My Custom Servant",
            specialization=ServantSpecialization.IMPLEMENTATION,
            tier=ServantTier.EXPERT
        )
    
    async def _execute_specialized_task(self, request: Dict[str, Any]) -> Dict[str, Any]:
        """å°‚é–€ã‚¿ã‚¹ã‚¯å®Ÿè£…"""
        # ã‚ãªãŸã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ã“ã“ã«å®Ÿè£…
        return {"status": "completed", "result": "success"}
    
    def get_specialized_capabilities(self) -> List[str]:
        """å°‚é–€èƒ½åŠ›å®šç¾©"""
        return ["custom_implementation", "specialized_processing"]

# ã‚µãƒ¼ãƒãƒ³ãƒˆä½¿ç”¨
servant = MyCustomServant()
result = await servant.process_request({"task": "example"})
```

### å°‚é–€ç‰¹åŒ–ã‚µãƒ¼ãƒãƒ³ãƒˆä½¿ç”¨ä¾‹

```python
from libs.elder_servants.base.specialized_elder_servants import (
    SpecializedServantFactory,
    ServantSpecialization
)

# ãƒ‰ãƒ¯ãƒ¼ãƒ•å·¥æˆ¿ã‚µãƒ¼ãƒãƒ³ãƒˆä½œæˆ
dwarf_servant = SpecializedServantFactory.create_servant(
    servant_type="dwarf",
    servant_id="dwarf_001",
    servant_name="Code Crafter",
    specialization=ServantSpecialization.IMPLEMENTATION
)

# æˆæœç‰©è£½ä½œ
craft_result = await dwarf_servant.craft_artifact({
    "type": "python_module",
    "requirements": ["high_performance", "secure"],
    "quality_target": 95.0
})
```

### A2Aé€šä¿¡è¨­å®š

```python
from libs.elder_servants.base.enhanced_elder_servant import A2ACommunication

a2a_config = A2ACommunication(
    host="localhost",
    port=8001,
    max_connections=100,
    timeout_seconds=30
)

servant = MyCustomServant(a2a_config=a2a_config)

# ä»–ã®ã‚µãƒ¼ãƒãƒ³ãƒˆã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
response = await servant.send_a2a_message(
    target_servant_id="target_servant_001",
    message={"type": "collaboration_request", "data": "hello"}
)
```

### 4è³¢è€…é€£æºè¨­å®š

```python
from libs.elder_servants.base.enhanced_elder_servant import SageCollaboration

sage_config = SageCollaboration(
    knowledge_sage_endpoint="localhost:8001",
    task_sage_endpoint="localhost:8002",
    incident_sage_endpoint="localhost:8003",
    rag_sage_endpoint="localhost:8004"
)

servant = MyCustomServant(sage_config=sage_config)
```

### å“è³ªã‚²ãƒ¼ãƒˆè¨­å®š

```python
from libs.elder_servants.base.enhanced_elder_servant import QualityGate

quality_config = QualityGate(
    iron_will_threshold=98.0,        # ã‚ˆã‚Šå³ã—ã„å“è³ªåŸºæº–
    test_coverage_minimum=95.0,
    auto_rejection=True,
    escalation_enabled=True
)

servant = MyCustomServant(quality_config=quality_config)
```

### å­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ è¨­å®š

```python
from libs.elder_servants.base.enhanced_elder_servant import LearningConfig

learning_config = LearningConfig(
    enabled=True,
    learning_rate=0.1,
    auto_adaptation=True,
    success_pattern_learning=True,
    failure_pattern_learning=True
)

servant = MyCustomServant(learning_config=learning_config)
```

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

### çµ±åˆå‡¦ç†ãƒ•ãƒ­ãƒ¼

1. **äºˆé˜²çš„å“è³ªãƒã‚§ãƒƒã‚¯** - ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆé¨å£«å›£ã«ã‚ˆã‚‹äº‹å‰æ¤œè¨¼
2. **4è³¢è€…äº‹å‰ç›¸è«‡** - è¤‡é›‘ã‚¿ã‚¹ã‚¯ã®å ´åˆã®è‡ªå‹•ç›¸è«‡
3. **å°‚é–€ã‚¿ã‚¹ã‚¯å®Ÿè¡Œ** - å„ã‚µãƒ¼ãƒãƒ³ãƒˆå›ºæœ‰ã®å‡¦ç†
4. **å“è³ªã‚²ãƒ¼ãƒˆæ¤œè¨¼** - Iron WillåŸºæº–ã«ã‚ˆã‚‹å“è³ªä¿è¨¼
5. **è‡ªå‹•ä¿®å¾©** - å“è³ªå•é¡Œã®è‡ªå‹•æ”¹å–„
6. **å­¦ç¿’ãƒ»é©å¿œ** - å®Ÿè¡Œçµæœã‹ã‚‰ã®ç¶™ç¶šå­¦ç¿’
7. **ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°** - çµ±è¨ˆãƒ»ç›£è¦–ãƒ‡ãƒ¼ã‚¿æ›´æ–°

### å“è³ªåŸºæº–ï¼ˆIron Willï¼‰

- **æ ¹æœ¬åŸå› è§£æ±ºåº¦**: 95%ä»¥ä¸Š
- **ä¾å­˜é–¢ä¿‚å®Œå…¨æ€§**: 100%å¿…é ˆ
- **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸**: 95%æœ€ä½
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚³ã‚¢**: 90%ä»¥ä¸Š
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: 85%ç¶­æŒ
- **ä¿å®ˆæ€§**: 80%ä»¥ä¸Š

### ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†

è‡ªå‹•çš„ã«ä»¥ä¸‹ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’åé›†ãƒ»è¿½è·¡ï¼š

- ã‚¿ã‚¹ã‚¯å®Ÿè¡Œçµ±è¨ˆï¼ˆæˆåŠŸç‡ã€å®Ÿè¡Œæ™‚é–“ï¼‰
- å“è³ªã‚¹ã‚³ã‚¢ï¼ˆIron Willæº–æ‹ ç‡ï¼‰
- A2Aé€šä¿¡çµ±è¨ˆï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€å—ä¿¡ï¼‰
- 4è³¢è€…é€£æºçµ±è¨ˆï¼ˆç›¸è«‡æˆåŠŸç‡ï¼‰
- å­¦ç¿’çµ±è¨ˆï¼ˆãƒ‘ã‚¿ãƒ¼ãƒ³å­¦ç¿’ã€é©å¿œï¼‰
- ã‚·ã‚¹ãƒ†ãƒ çµ±è¨ˆï¼ˆCPUã€ãƒ¡ãƒ¢ãƒªã€ç¨¼åƒæ™‚é–“ï¼‰

## ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
# åŸºåº•ã‚¯ãƒ©ã‚¹ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pytest tests/unit/test_enhanced_elder_servant.py -v

# ã™ã¹ã¦ã®ã‚µãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pytest tests/unit/test_*_servant.py -v

# ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ããƒ†ã‚¹ãƒˆ
pytest --cov=libs.elder_servants.base tests/unit/ --cov-report=html
```

## è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä¾‹

### ã‚µãƒ¼ãƒãƒ³ãƒˆè¨­å®š (servant_config.json)

```json
{
  "servant_id": "dwarf_code_crafter_001",
  "servant_name": "Master Code Crafter",
  "specialization": "implementation",
  "tier": "master",
  "a2a_config": {
    "host": "localhost",
    "port": 8001,
    "max_connections": 100
  },
  "sage_config": {
    "knowledge_sage_endpoint": "localhost:8001",
    "task_sage_endpoint": "localhost:8002",
    "incident_sage_endpoint": "localhost:8003",
    "rag_sage_endpoint": "localhost:8004"
  },
  "quality_config": {
    "iron_will_threshold": 95.0,
    "auto_rejection": true
  },
  "learning_config": {
    "enabled": true,
    "auto_adaptation": true
  }
}
```

## æ‹¡å¼µã‚¬ã‚¤ãƒ‰

### ã‚«ã‚¹ã‚¿ãƒ å°‚é–€åˆ†é‡è¿½åŠ 

1. `ServantSpecialization` ã«enumè¿½åŠ 
2. å°‚é–€ç‰¹åŒ–åŸºåº•ã‚¯ãƒ©ã‚¹ã‚’ç¶™æ‰¿
3. `_execute_specialized_task` å®Ÿè£…
4. `get_specialized_capabilities` å®Ÿè£…
5. å°‚é–€ãƒ¡ãƒˆãƒªã‚¯ã‚¹å®šç¾©

### ã‚«ã‚¹ã‚¿ãƒ å“è³ªåŸºæº–è¿½åŠ 

1. `_evaluate_iron_will_criteria` æ‹¡å¼µ
2. æ–°åŸºæº–ç”¨è©•ä¾¡ãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè£…
3. é–¾å€¤è¨­å®šã® `_get_criteria_threshold` æ›´æ–°

### ã‚«ã‚¹ã‚¿ãƒ å­¦ç¿’ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ è¿½åŠ 

1. `_learn_success_pattern` / `_learn_failure_pattern` æ‹¡å¼µ
2. `_adapt_behavior` ã«ã‚«ã‚¹ã‚¿ãƒ ãƒ­ã‚¸ãƒƒã‚¯è¿½åŠ 
3. å­¦ç¿’ãƒ¡ãƒˆãƒªã‚¯ã‚¹è¿½åŠ 

## é–¢é€£æ–‡æ›¸

- [Elder Treeåˆ†æ•£AIã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ä»•æ§˜æ›¸](../../../docs/technical/ELDER_TREE_DISTRIBUTED_AI_ARCHITECTURE.md)
- [Issue #257: Elder Treeåˆ†æ•£AIã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å®Ÿè£…ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ](../../../docs/issues/issue-257-elder-tree-distributed-ai-architecture.md)
- [CLAUDE.md](../../../CLAUDE.md)

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

Elder Guild Development License v1.0