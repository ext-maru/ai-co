{% extends "base.html" %}

{% block title %}顧客作成 - 画像アップロード管理システム{% endblock %}

{% block header %}👤 顧客作成{% endblock %}

{% block content %}
<div class="nav-links">
    <a href="/admin">👈 管理者ページ</a>
</div>

<div class="card">
    <h2>👤 新しい顧客を作成</h2>
    <p>顧客情報を入力して、画像アップロード用のアカウントを作成します。</p>
    
    <form method="POST" style="margin-top: 20px;">
        <div class="form-group">
            <label for="name">顧客名 *</label>
            <input type="text" id="name" name="name" required 
                   placeholder="例: 山田太郎">
        </div>
        
        <div class="form-group">
            <label for="email">メールアドレス</label>
            <input type="email" id="email" name="email" 
                   placeholder="例: yamada@example.com">
        </div>
        
        <div class="form-group">
            <label for="phone">電話番号</label>
            <input type="tel" id="phone" name="phone" 
                   placeholder="例: 090-1234-5678">
        </div>
        
        <div style="text-align: center; margin-top: 30px;">
            <button type="submit" class="btn btn-success">
                ✅ 顧客を作成
            </button>
            <a href="/admin" class="btn btn-secondary">
                キャンセル
            </a>
        </div>
    </form>
</div>

<div class="card">
    <h3>ℹ️ 顧客作成について</h3>
    <ul style="padding-left: 20px;">
        <li><strong>顧客名</strong>は必須項目です</li>
        <li><strong>メールアドレス</strong>と<strong>電話番号</strong>は任意です</li>
        <li>作成後、顧客専用のURLが生成されます</li>
        <li>顧客IDは自動的に生成されます（UUID形式）</li>
        <li>顧客には以下の画像をアップロードしてもらうことができます：
            <ul style="margin-top: 10px;">
                <li>身分証明書</li>
                <li>住民票</li>
                <li>収入証明書</li>
                <li>契約書</li>
                <li>銀行明細</li>
                <li>その他書類</li>
            </ul>
        </li>
    </ul>
</div>

<div class="card">
    <h3>📝 作成後の流れ</h3>
    <ol style="padding-left: 20px;">
        <li><strong>顧客作成</strong> - このフォームで顧客情報を入力</li>
        <li><strong>URL生成</strong> - 顧客専用のアップロードURLが生成される</li>
        <li><strong>URL送信</strong> - 顧客にURLを送信（メール、電話等）</li>
        <li><strong>画像アップロード</strong> - 顧客がURLから画像をアップロード</li>
        <li><strong>管理者確認</strong> - 管理者ページで画像を確認・承認</li>
        <li><strong>GoogleDrive保存</strong> - 承認済み画像が自動保存される</li>
    </ol>
</div>
{% endblock %}

{% block scripts %}
<script>
// フォームバリデーション
document.querySelector('form').addEventListener('submit', function(e) {
    const name = document.getElementById('name').value.trim();
    
    if (!name) {
        e.preventDefault();
        showAlert('顧客名を入力してください', 'error');
        return;
    }
    
    if (name.length < 2) {
        e.preventDefault();
        showAlert('顧客名は2文字以上で入力してください', 'error');
        return;
    }
    
    // 送信前の確認
    if (!confirm(`顧客「${name}」を作成しますか？`)) {
        e.preventDefault();
        return;
    }
    
    showLoading();
});

// 電話番号の自動フォーマット
document.getElementById('phone').addEventListener('input', function(e) {
    let value = e.target.value.replace(/[^\d]/g, '');
    
    if (value.length > 0) {
        if (value.length <= 3) {
            value = value;
        } else if (value.length <= 7) {
            value = value.slice(0, 3) + '-' + value.slice(3);
        } else {
            value = value.slice(0, 3) + '-' + value.slice(3, 7) + '-' + value.slice(7, 11);
        }
    }
    
    e.target.value = value;
});

// 入力フィールドのフォーカス効果
document.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"]').forEach(input => {
    input.addEventListener('focus', function() {
        this.style.borderColor = '#3498db';
        this.style.boxShadow = '0 0 5px rgba(52, 152, 219, 0.3)';
    });
    
    input.addEventListener('blur', function() {
        this.style.borderColor = '#ddd';
        this.style.boxShadow = 'none';
    });
});
</script>
{% endblock %}