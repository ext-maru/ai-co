# ã‚¨ãƒ«ãƒ•ã®æ£® å”èª¿è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
# ğŸ§â€â™‚ï¸ ã‚¿ã‚¹ã‚¯ã‚¨ãƒ«ãƒ€ãƒ¼ + ã‚¨ãƒ«ãƒ•å”èª¿ã‚·ã‚¹ãƒ†ãƒ 

forest_configuration:
  name: "ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆä¿®æ­£"
  batch_id: "test_fix_batch_20250710_030000"
  
elf_assignments:
  # ğŸŒ¿ æ£®ã®ç™’ã— (æœ€é©åŒ–ãƒ»æ”¹å–„)
  optimization_elves:
    - task: "fix_models_py"
      elves: 2
      focus: "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«æœ€é©åŒ–"
      
    - task: "fix_google_drive_service"
      elves: 3
      focus: "APIçµ±åˆã¨ãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè£…"
      
  # ğŸ¦‹ ç”Ÿæ…‹ç³»ç¶­æŒ (ç¶™ç¶šç›£è¦–)
  monitoring_elves:
    - task: "test_environment_health"
      elves: 1
      focus: "ãƒ†ã‚¹ãƒˆç’°å¢ƒã®å¥å…¨æ€§ç›£è¦–"
      
  # ğŸŒ± æ–°èŠ½è‚²æˆ (ãƒ†ã‚¹ãƒˆãƒ»å“è³ªå‘ä¸Š)
  quality_elves:
    - task: "coverage_improvement"
      elves: 2
      focus: "ã‚«ãƒãƒ¬ãƒƒã‚¸67%â†’80%å‘ä¸Š"
      
parallel_execution_plan:
  phase_1:
    duration_minutes: 15
    tasks:
      - id: "fix_models_py"
        servants: 2
        command: |
          # server_defaultè¿½åŠ 
          sed -i 's/created_at = db.Column(db.DateTime/created_at = db.Column(db.DateTime, nullable=False, server_default=func.now()/' app/models.py
          # __repr__ãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè£…
          python3 -c "
          import re
          with open('app/models.py', 'r') as f: content = f.read()
          # Customer __repr__
          content = re.sub(r'(class Customer.*?)(class|\Z)', 
            lambda m: m.group(1) + '\n    def __repr__(self):\n        return f\"<Customer {self.id}: {self.name}>\"\n\n' + (m.group(2) if m.group(2) else ''), 
            content, flags=re.DOTALL)
          # åŒæ§˜ã«CustomerImage, SystemConfigã‚‚å‡¦ç†
          with open('app/models.py', 'w') as f: f.write(content)
          "
          
      - id: "fix_google_drive_service"
        servants: 3
        command: |
          # MediaFileUploadã‚¤ãƒ³ãƒãƒ¼ãƒˆè¿½åŠ 
          sed -i '1a from googleapiclient.http import MediaFileUpload' app/google_drive_service.py
          # create_folder, upload_fileãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè£…ï¼ˆè©³ç´°ã¯æŒ‡ç¤ºæ›¸å‚ç…§ï¼‰
          
      - id: "fix_test_environment"
        servants: 1
        command: |
          pip install pytest-mock --break-system-packages
          # conftest.pyæ›´æ–°
          
  phase_2:
    duration_minutes: 10
    dependencies: ["fix_models_py"]
    tasks:
      - id: "fix_app_routes"
        servants: 2
        command: |
          # EXIFå‡¦ç†ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ä¿®æ­£
          
quality_gates:
  - gate: "unit_test_pass"
    condition: "all_tests_pass == true"
    
  - gate: "coverage_check"
    condition: "coverage >= 67"
    
  - gate: "no_regression"
    condition: "new_failures == 0"
    
reporting:
  auto_generate: true
  recipients:
    - "elder_council"
    - "claude_elder"
    - "task_sage"
    
  format: |
    ## ã‚¿ã‚¹ã‚¯ã‚¨ãƒ«ãƒ€ãƒ¼å®Ÿè¡Œå ±å‘Š
    - ãƒãƒƒãƒID: {batch_id}
    - å®Ÿè¡Œæ™‚é–“: {execution_time}
    - æˆåŠŸã‚¿ã‚¹ã‚¯: {success_count}/{total_count}
    - ãƒ†ã‚¹ãƒˆçµæœ: {test_results}
    - ã‚«ãƒãƒ¬ãƒƒã‚¸: {coverage}%
    
rollback_strategy:
  enabled: true
  trigger: "any_task_failure"
  method: "git_restore"