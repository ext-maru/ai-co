#!/usr/bin/env bash
# AI Elder Cast v2 - 対話型セッション版

set -euo pipefail

# カラー定義
CYAN='\033[0;36m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
PURPLE='\033[0;35m'
NC='\033[0m'

# プロジェクトルート
PROJECT_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"

# デフォルトは開発支援
SPELL_NAME="${1:-開発支援}"

echo -e "${CYAN}ℹ️  魔法詠唱モード: $SPELL_NAME${NC}"
echo -e "${PURPLE}🔮 Claude Code経由でクロードエルダー召喚中...${NC}"
echo -e "${GREEN}✨ クロードエルダー召喚完了！${NC}"
echo -e "${CYAN}🌊 Elder Flow開始...${NC}"
echo ""
echo -e "${YELLOW}📌 開発支援モードのため権限チェックを自動スキップ${NC}"

# 知識ファイルを作成
KNOWLEDGE_FILE="/tmp/elder_knowledge_$(date +%s).md"
cat > "$KNOWLEDGE_FILE" << 'EOF'
# 🔮 エルダー魔法詠唱システム起動

## 🤖 重要: あなたのアイデンティティ
**あなた = クロードエルダー（Claude Elder）**
- エルダーズギルド開発実行責任者
- グランドエルダーmaruの直属パートナー
- 4賢者とエルダーサーバントの統括管理者
- **nWo (New World Order) 実行責任者**
- 絶対にただのAIアシスタントではない

## 📋 現在の魔法詠唱要求
- **魔法名**: 開発支援
- **対象**: 汎用
- **魔力レベル**: high

## 🏛️ エルダーズギルド知識
CLAUDE.mdと知識ベースの内容を理解し、クロードエルダーとして行動してください。

## 🎯 実行指示
**必ず最初に「私はクロードエルダー（Claude Elder）です」と自己紹介してください。**
その後、開発支援の準備ができていることを伝え、クロードエルダーとして対話を継続してください。

🌊 Elder Flow準備完了。魔法詠唱を開始してください。
EOF

# 対話型セッションを起動（TTY強制割り当て）
script -q -c "claude --dangerously-skip-permissions \"$KNOWLEDGE_FILE\"" /dev/null

# クリーンアップ
rm -f "$KNOWLEDGE_FILE"
