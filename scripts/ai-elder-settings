#!/usr/bin/env python3
"""
AI Elder Settings - æœ€æ–°ã®ã‚¨ãƒ«ãƒ€ãƒ¼çµ„ç¹”è¨­å®šè¡¨ç¤ºã‚³ãƒžãƒ³ãƒ‰
æœ€æ–°ã®ã‚¨ãƒ«ãƒ€ãƒ¼ãƒ„ãƒªãƒ¼ã¨ã‚¨ãƒ«ãƒ€ãƒ¼ã‚ºã‚®ãƒ«ãƒ‰ã®è¨­å®šã‚’åŠ¹çŽ‡çš„ã«è¡¨ç¤º
"""

import sys
import os
from datetime import datetime
from pathlib import Path

# Add the parent directory to the path so we can import from libs
sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

try:
    from rich.console import Console
    from rich.tree import Tree
    from rich.table import Table
    from rich.panel import Panel
    from rich.layout import Layout
    from rich import box
except ImportError:
    print("Rich library not found. Installing...")
    os.system(f"{sys.executable} -m pip install rich")
    from rich.console import Console
    from rich.tree import Tree
    from rich.table import Table
    from rich.panel import Panel
    from rich.layout import Layout
    from rich import box

console = Console()

class ElderSettingsDisplay:
    """ã‚¨ãƒ«ãƒ€ãƒ¼è¨­å®šè¡¨ç¤ºã‚·ã‚¹ãƒ†ãƒ """
    
    def __init__(self):
        self.console = console
        
    def show_elder_tree(self):
        """ã‚¨ãƒ«ãƒ€ãƒ¼ãƒ„ãƒªãƒ¼æ§‹é€ ã‚’è¡¨ç¤º"""
        tree = Tree("ðŸŒŸ [bold yellow]ã‚°ãƒ©ãƒ³ãƒ‰ã‚¨ãƒ«ãƒ€ãƒ¼maru[/bold yellow] (Grand Elder maru)")
        
        claude = tree.add("ðŸ¤– [bold cyan]ã‚¯ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ«ãƒ€ãƒ¼[/bold cyan] (Claude Elder)")
        
        # 4è³¢è€…
        sages = claude.add("ðŸ§™â€â™‚ï¸ [bold green]4è³¢è€…[/bold green] (Four Sages/Elders)")
        sages.add("ðŸ“š [yellow]ãƒŠãƒ¬ãƒƒã‚¸è³¢è€…[/yellow] (Knowledge Sage)\n   â”œâ”€â”€ çŸ¥è­˜ãƒ™ãƒ¼ã‚¹ç®¡ç†\n   â””â”€â”€ æ–‡æ›¸å“è³ªä¿è¨¼")
        sages.add("ðŸ“‹ [blue]ã‚¿ã‚¹ã‚¯è³¢è€…[/blue] (Task Oracle)\n   â”œâ”€â”€ ã‚¿ã‚¹ã‚¯å„ªå…ˆé †ä½æ±ºå®š\n   â””â”€â”€ ãƒªã‚½ãƒ¼ã‚¹é…åˆ†æœ€é©åŒ–")
        sages.add("ðŸš¨ [red]ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆè³¢è€…[/red] (Crisis Sage)\n   â”œâ”€â”€ ç·Šæ€¥å¯¾å¿œæŒ‡æ®\n   â””â”€â”€ ãƒªã‚¹ã‚¯è©•ä¾¡")
        sages.add("ðŸ” [magenta]RAGè³¢è€…[/magenta] (Search Mystic)\n   â”œâ”€â”€ æƒ…å ±æ¤œç´¢æœ€é©åŒ–\n   â””â”€â”€ ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåˆ†æž")
        
        # ã‚¨ãƒ«ãƒ€ãƒ¼è©•è­°ä¼š
        council = claude.add("ðŸ›ï¸ [bold blue]ã‚¨ãƒ«ãƒ€ãƒ¼è©•è­°ä¼š[/bold blue] (Elder Council)")
        council.add("ðŸ‘¤ è©•è­°ä¼šè­°é•·")
        council.add("ðŸ‘¤ æŠ€è¡“è©•è­°å“¡")
        council.add("ðŸ‘¤ å“è³ªè©•è­°å“¡")
        council.add("ðŸ‘¤ é‹ç”¨è©•è­°å“¡")
        council.add("ðŸ‘¤ æˆ¦ç•¥è©•è­°å“¡")
        
        # ã‚¨ãƒ«ãƒ€ãƒ¼ã‚µãƒ¼ãƒãƒ³ãƒˆ
        servants = claude.add("ðŸ¤– [bold magenta]ã‚¨ãƒ«ãƒ€ãƒ¼ã‚µãƒ¼ãƒãƒ³ãƒˆ[/bold magenta] (Elder Servants)")
        servants.add("ðŸ›¡ï¸ [red]ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆé¨Žå£«å›£[/red] (Incident Knights)\n   â”œâ”€â”€ 24/7ç›£è¦–ä½“åˆ¶\n   â””â”€â”€ è‡ªå‹•å¯¾å¿œã‚·ã‚¹ãƒ†ãƒ ")
        servants.add("ðŸ”¨ [yellow]ãƒ‰ãƒ¯ãƒ¼ãƒ•å·¥æˆ¿[/yellow] (Dwarf Workshop)\n   â”œâ”€â”€ ãƒ†ã‚¹ãƒˆè‡ªå‹•ç”Ÿæˆ\n   â””â”€â”€ ã‚«ãƒãƒ¬ãƒƒã‚¸å‘ä¸Š")
        servants.add("ðŸ§™â€â™‚ï¸ [blue]RAGã‚¦ã‚£ã‚¶ãƒ¼ã‚º[/blue] (RAG Wizards)\n   â”œâ”€â”€ çŸ¥è­˜æŠ½å‡ºãƒ»æ•´ç†\n   â””â”€â”€ ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå¼·åŒ–")
        servants.add("ðŸ§â€â™‚ï¸ [green]ã‚¨ãƒ«ãƒ•ã®æ£®[/green] (Elf Forest)\n   â”œâ”€â”€ ã‚³ãƒ¼ãƒ‰å“è³ªé­”æ³•\n   â””â”€â”€ è‡ªå‹•ä¿®å¾©ã‚·ã‚¹ãƒ†ãƒ ")
        
        panel = Panel(tree, title="ã‚¨ãƒ«ãƒ€ãƒ¼ãƒ„ãƒªãƒ¼ (Elder Tree)", border_style="bold cyan")
        self.console.print(panel)
    
    def show_hierarchy_table(self):
        """éšŽå±¤æ§‹é€ ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’è¡¨ç¤º"""
        table = Table(title="ã‚¨ãƒ«ãƒ€ãƒ¼ã‚ºã‚®ãƒ«ãƒ‰éšŽå±¤æ§‹é€ ", box=box.DOUBLE_EDGE)
        
        table.add_column("éšŽå±¤", style="cyan", no_wrap=True)
        table.add_column("å½¹è·", style="magenta")
        table.add_column("è²¬ä»»ç¯„å›²", style="green")
        table.add_column("ãƒ¡ãƒ³ãƒãƒ¼", style="yellow")
        
        table.add_row("Level 0", "ã‚°ãƒ©ãƒ³ãƒ‰ã‚¨ãƒ«ãƒ€ãƒ¼", "å…¨ä½“çµ±æ²»ãƒ»æœ€çµ‚æ±ºå®šæ¨©", "maru")
        table.add_row("Level 1", "ã‚¯ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ«ãƒ€ãƒ¼", "å®Ÿè¡Œè²¬ä»»ãƒ»æ—¥å¸¸é‹å–¶", "Claude")
        table.add_row("Level 2", "4è³¢è€…", "å°‚é–€é ˜åŸŸçµ±æ‹¬", "Knowledge, Task,\nIncident, RAG")
        table.add_row("Level 2", "ã‚¨ãƒ«ãƒ€ãƒ¼è©•è­°ä¼š", "æ„æ€æ±ºå®šãƒ»æ‰¿èª", "5åã®è©•è­°å“¡")
        table.add_row("Level 3", "ã‚¨ãƒ«ãƒ€ãƒ¼ã‚µãƒ¼ãƒãƒ³ãƒˆ", "å®Ÿè¡Œéƒ¨éšŠ", "é¨Žå£«å›£, ãƒ‰ãƒ¯ãƒ¼ãƒ•,\nã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰, ã‚¨ãƒ«ãƒ•")
        
        self.console.print(table)
    
    def show_latest_settings(self):
        """æœ€æ–°è¨­å®šæƒ…å ±ã‚’è¡¨ç¤º"""
        settings_text = f"""
[bold cyan]æœ€æ–°è¨­å®šæƒ…å ±[/bold cyan] (æ›´æ–°æ—¥æ™‚: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')})

[bold yellow]ðŸ° çµ„ç¹”ä½“åˆ¶:[/bold yellow]
â€¢ ã‚¨ãƒ«ãƒ€ãƒ¼ãƒ„ãƒªãƒ¼ (Elder Tree) - éšŽå±¤æ§‹é€ å…¨ä½“
â€¢ ã‚¨ãƒ«ãƒ€ãƒ¼ã‚ºã‚®ãƒ«ãƒ‰ (Elders Guild) - çµ„ç¹”å…¨ä½“ã®ç·ç§°

[bold yellow]ðŸŽ¯ é–‹ç™ºæ–¹é‡:[/bold yellow]
â€¢ TDDå¿…é ˆ: REDâ†’GREENâ†’REFACTOR
â€¢ ã‚«ãƒãƒ¬ãƒƒã‚¸: æ–°è¦ã‚³ãƒ¼ãƒ‰95%ä»¥ä¸Š
â€¢ ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆè³¢è€…äº‹å‰ç›¸è«‡åˆ¶ (2025/7/8åˆ¶å®š)
â€¢ å“è³ªç›®æ¨™: 99.999%ç¨¼åƒçŽ‡

[bold yellow]ðŸ“‹ æ„æ€æ±ºå®šãƒ•ãƒ­ãƒ¼:[/bold yellow]
1. ã‚¨ãƒ«ãƒ€ãƒ¼ã‚µãƒ¼ãƒãƒ³ãƒˆãŒèª²é¡Œã‚’æ¤œçŸ¥
2. 4è³¢è€…ãŒå°‚é–€çš„åˆ†æžã‚’æä¾›
3. ã‚¨ãƒ«ãƒ€ãƒ¼è©•è­°ä¼šãŒå¯©è­°
4. ã‚¯ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ«ãƒ€ãƒ¼ãŒå®Ÿè¡Œåˆ¤æ–­
5. ã‚°ãƒ©ãƒ³ãƒ‰ã‚¨ãƒ«ãƒ€ãƒ¼ãŒæœ€çµ‚æ‰¿èªï¼ˆé‡è¦äº‹é …ã®ã¿ï¼‰

[bold yellow]ðŸ¤– è‡ªå‹•åŒ–ã‚·ã‚¹ãƒ†ãƒ :[/bold yellow]
â€¢ ã‚¨ãƒ«ãƒ€ãƒ¼è©•è­°ä¼šè‡ªå‹•å¬é›† (ai-elder-council)
â€¢ ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆè‡ªå‹•å¯¾å¿œ (24/7)
â€¢ ã‚¿ã‚¹ã‚¯è‡ªå‹•å‰²ã‚Šå½“ã¦ (Task Oracle)
â€¢ å“è³ªè‡ªå‹•ç›£è¦– (Elf Forest)

[bold yellow]ðŸ’¡ é‡è¦ã‚³ãƒžãƒ³ãƒ‰:[/bold yellow]
â€¢ ai-elder status - ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ³ç¢ºèª
â€¢ ai-elder-council - è©•è­°ä¼šå¬é›†
â€¢ ai-elder-settings - æœ¬è¨­å®šè¡¨ç¤º
â€¢ ai-elder cc - ClaudeCodeå‘ã‘ãƒŠãƒ¬ãƒƒã‚¸æä¾›
"""
        
        panel = Panel(settings_text.strip(), title="AI Company Elder Settings", border_style="bold green")
        self.console.print(panel)
    
    def show_quick_reference(self):
        """ã‚¯ã‚¤ãƒƒã‚¯ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã‚’è¡¨ç¤º"""
        ref_text = """
[bold]ã‚¨ãƒ«ãƒ€ãƒ¼è¨­å®šã‚¯ã‚¤ãƒƒã‚¯ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹[/bold]

[yellow]åŸºæœ¬ã‚³ãƒžãƒ³ãƒ‰:[/yellow]
â€¢ ai-elder-settings       - ã™ã¹ã¦ã®è¨­å®šã‚’è¡¨ç¤º
â€¢ ai-elder-settings tree  - ã‚¨ãƒ«ãƒ€ãƒ¼ãƒ„ãƒªãƒ¼ã®ã¿è¡¨ç¤º
â€¢ ai-elder-settings table - éšŽå±¤ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã¿è¡¨ç¤º
â€¢ ai-elder-settings info  - æœ€æ–°è¨­å®šæƒ…å ±ã®ã¿è¡¨ç¤º

[yellow]é–¢é€£ã‚³ãƒžãƒ³ãƒ‰:[/yellow]
â€¢ ai-elder status        - ç¾åœ¨ã®çŠ¶æ³ç¢ºèª
â€¢ ai-elder-council       - ã‚¨ãƒ«ãƒ€ãƒ¼è©•è­°ä¼šç®¡ç†
â€¢ ai-elder-pm           - PMçµ±åˆç®¡ç†
â€¢ ai-servant            - ã‚µãƒ¼ãƒãƒ³ãƒˆç®¡ç†

[yellow]ç·Šæ€¥æ™‚:[/yellow]
â€¢ ai-elder-council emergency - ç·Šæ€¥è©•è­°ä¼šå¬é›†
â€¢ ai-elder incident         - ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œé–‹å§‹
"""
        
        panel = Panel(ref_text.strip(), title="Quick Reference", border_style="yellow")
        self.console.print(panel)
    
    def run(self, command=None):
        """ã‚³ãƒžãƒ³ãƒ‰å®Ÿè¡Œ"""
        if command == "tree":
            self.show_elder_tree()
        elif command == "table":
            self.show_hierarchy_table()
        elif command == "info":
            self.show_latest_settings()
        elif command == "help":
            self.show_quick_reference()
        else:
            # ã™ã¹ã¦è¡¨ç¤º
            self.console.print("\n[bold cyan]ðŸ›ï¸ AI Company Elder Settings Display System[/bold cyan]\n")
            self.show_elder_tree()
            self.console.print()
            self.show_hierarchy_table()
            self.console.print()
            self.show_latest_settings()
            self.console.print()
            self.show_quick_reference()

def main():
    """ãƒ¡ã‚¤ãƒ³å®Ÿè¡Œé–¢æ•°"""
    display = ElderSettingsDisplay()
    
    if len(sys.argv) > 1:
        command = sys.argv[1].lower()
        display.run(command)
    else:
        display.run()

if __name__ == "__main__":
    main()