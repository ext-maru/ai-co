#!/bin/bash
# ユーザー応答送信コマンド

if [ $# -lt 2 ]; then
    echo "使用方法: ai-reply <conversation_id> <response>"
    exit 1
fi

CONV_ID=$1
shift
RESPONSE="$*"

cd /root/ai_co
source venv/bin/activate

python3 -c "
import pika
import json

connection = pika.BlockingConnection(pika.ConnectionParameters('localhost'))
channel = connection.channel()

data = {
    'conversation_id': '$CONV_ID',
    'response': '$RESPONSE'
}

channel.basic_publish(
    exchange='',
    routing_key='user_input_queue',
    body=json.dumps(data),
    properties=pika.BasicProperties(delivery_mode=2)
)

print(f'✅ 応答送信: $CONV_ID')
connection.close()
"
