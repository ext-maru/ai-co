#!/bin/bash
# Git Elder Commit - Elder Flowを自動適用するgitコミットラッパー

set -euo pipefail

# カラー定義
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

# Elder Flow自動適用キーワード
KEYWORDS="実装|implement|add|create|build|develop|新機能|修正|fix|bug|エラー|error|問題|issue|最適化|optimize|リファクタリング|refactor|改善|セキュリティ|security|認証|authentication"

# コミットメッセージ取得
COMMIT_MSG="$1"

# Elder Flow適用判定
if echo "$COMMIT_MSG" | grep -qE "$KEYWORDS"; then
    echo -e "${YELLOW}🌊 Elder Flow適用条件を検出しました！${NC}"
    echo -e "${BLUE}🔄 Elder Flowを自動実行します...${NC}"
    
    # Elder Flow実行
    if command -v elder-flow &> /dev/null; then
        elder-flow execute "$COMMIT_MSG" --priority high --auto-commit
        echo -e "${GREEN}✅ Elder Flow経由でコミットが完了しました！${NC}"
    else
        echo -e "${RED}❌ Elder Flowが見つかりません。通常のコミットを実行します。${NC}"
        git commit -m "$COMMIT_MSG"
    fi
else
    # 通常のコミット
    echo -e "${GREEN}✅ Elder Flow適用条件外のため、通常コミットを実行します${NC}"
    git commit -m "$COMMIT_MSG"
fi