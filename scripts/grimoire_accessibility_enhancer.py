#!/usr/bin/env python3
"""
ã‚°ãƒªãƒ¢ã‚¢ã‚¢ã‚¯ã‚»ã‚¹æ€§å‘ä¸Šã‚·ã‚¹ãƒ†ãƒ 
4è³¢è€…ã®é­”æ³•æ›¸ã‚·ã‚¹ãƒ†ãƒ ã‚’ã‚ˆã‚Šä½¿ã„ã‚„ã™ãã€ã‚¢ã‚¯ã‚»ã‚¹ã—ã‚„ã™ãã™ã‚‹
"""

import os
import sys
import json
import shutil
from datetime import datetime
from pathlib import Path
from typing import Dict, List, Any, Optional
import logging

PROJECT_ROOT = Path(__file__).parent.parent
sys.path.insert(0, str(PROJECT_ROOT))

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

class GrimoireAccessibilityEnhancer:
    """ã‚°ãƒªãƒ¢ã‚¢ã‚¢ã‚¯ã‚»ã‚¹æ€§å‘ä¸Šã‚·ã‚¹ãƒ†ãƒ """
    
    def __init__(self):
        self.project_root = PROJECT_ROOT
        self.grimoire_base = self.project_root / "knowledge_base" / "four_sages_grimoires"
        self.access_log = self.project_root / "logs" / "grimoire_accessibility.log"
        self.access_log.parent.mkdir(exist_ok=True)
        
        # ã‚¢ã‚¯ã‚»ã‚¹æ€§å‘ä¸Šã®å„ãƒ•ã‚§ãƒ¼ã‚º
        self.enhancement_phases = {
            "index_generation": False,
            "cross_referencing": False,
            "search_optimization": False,
            "navigation_improvement": False,
            "quick_access_tools": False
        }
        
        # æ—¢å­˜ã®é­”æ³•æ›¸æ§‹é€ 
        self.grimoire_structure = {
            "knowledge_sage": "01_knowledge_sage_grimoire.md",
            "task_oracle": "02_task_oracle_grimoire.md",
            "incident_sage": "03_incident_sage_grimoire.md",
            "rag_mystic": "04_rag_mystic_grimoire.md",
            "common_knowledge": "00_common_knowledge.md"
        }\n        \n    def enhance_accessibility(self) -> Dict[str, Any]:\n        \"\"\"ã‚¢ã‚¯ã‚»ã‚¹æ€§å‘ä¸Šã®å®Ÿè¡Œ\"\"\"\n        print(\"ğŸ”® ã‚°ãƒªãƒ¢ã‚¢ã‚¢ã‚¯ã‚»ã‚¹æ€§å‘ä¸Šã‚’é–‹å§‹...\")\n        \n        enhancement_results = {\n            \"timestamp\": datetime.now().isoformat(),\n            \"phases\": {},\n            \"improvements\": [],\n            \"overall_status\": \"enhancing\",\n            \"metrics\": {}\n        }\n        \n        # Phase 1: ç´¢å¼•ç”Ÿæˆ\n        phase1_result = self._generate_comprehensive_index()\n        enhancement_results[\"phases\"][\"index_generation\"] = phase1_result\n        \n        # Phase 2: ç›¸äº’å‚ç…§ã‚·ã‚¹ãƒ†ãƒ \n        phase2_result = self._create_cross_reference_system()\n        enhancement_results[\"phases\"][\"cross_referencing\"] = phase2_result\n        \n        # Phase 3: æ¤œç´¢æœ€é©åŒ–\n        phase3_result = self._optimize_search_functionality()\n        enhancement_results[\"phases\"][\"search_optimization\"] = phase3_result\n        \n        # Phase 4: ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ”¹å–„\n        phase4_result = self._improve_navigation()\n        enhancement_results[\"phases\"][\"navigation_improvement\"] = phase4_result\n        \n        # Phase 5: ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãƒ„ãƒ¼ãƒ«\n        phase5_result = self._create_quick_access_tools()\n        enhancement_results[\"phases\"][\"quick_access_tools\"] = phase5_result\n        \n        # ç·åˆè©•ä¾¡\n        enhancement_results[\"overall_status\"] = self._assess_enhancement_status()\n        enhancement_results[\"improvements\"] = self._collect_improvements()\n        enhancement_results[\"metrics\"] = self._calculate_metrics()\n        \n        return enhancement_results\n    \n    def _generate_comprehensive_index(self) -> Dict[str, Any]:\n        \"\"\"åŒ…æ‹¬çš„ç´¢å¼•ã®ç”Ÿæˆ\"\"\"\n        print(\"  ğŸ“š åŒ…æ‹¬çš„ç´¢å¼•ã‚’ç”Ÿæˆä¸­...\")\n        \n        index_result = {\n            \"status\": \"generating\",\n            \"master_index\": {},\n            \"topic_index\": {},\n            \"cross_references\": {},\n            \"generated_files\": []\n        }\n        \n        try:\n            # ãƒã‚¹ã‚¿ãƒ¼ç´¢å¼•ã®ç”Ÿæˆ\n            master_index = self._create_master_index()\n            index_result[\"master_index\"] = master_index\n            \n            # ãƒˆãƒ”ãƒƒã‚¯åˆ¥ç´¢å¼•ã®ç”Ÿæˆ\n            topic_index = self._create_topic_index()\n            index_result[\"topic_index\"] = topic_index\n            \n            # ç´¢å¼•ãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿæˆ\n            index_files = self._write_index_files(master_index, topic_index)\n            index_result[\"generated_files\"] = index_files\n            \n            index_result[\"status\"] = \"completed\"\n            self.enhancement_phases[\"index_generation\"] = True\n            \n        except Exception as e:\n            index_result[\"status\"] = \"failed\"\n            index_result[\"error\"] = str(e)\n        \n        self._log_enhancement(\"Index generation\", index_result[\"status\"])\n        return index_result\n    \n    def _create_master_index(self) -> Dict[str, Any]:\n        \"\"\"ãƒã‚¹ã‚¿ãƒ¼ç´¢å¼•ã®ä½œæˆ\"\"\"\n        master_index = {\n            \"total_entries\": 0,\n            \"sage_entries\": {},\n            \"category_distribution\": {},\n            \"last_updated\": datetime.now().isoformat()\n        }\n        \n        # å„è³¢è€…ã®é­”æ³•æ›¸ã‚’è§£æ\n        for sage_name, grimoire_file in self.grimoire_structure.items():\n            grimoire_path = self.grimoire_base / grimoire_file\n            \n            if grimoire_path.exists():\n                entries = self._extract_entries_from_grimoire(grimoire_path)\n                master_index[\"sage_entries\"][sage_name] = entries\n                master_index[\"total_entries\"] += len(entries)\n                \n                # ã‚«ãƒ†ã‚´ãƒªåˆ†å¸ƒã®è¨ˆç®—\n                for entry in entries:\n                    category = entry.get(\"category\", \"other\")\n                    master_index[\"category_distribution\"][category] = \\\n                        master_index[\"category_distribution\"].get(category, 0) + 1\n        \n        return master_index\n    \n    def _extract_entries_from_grimoire(self, grimoire_path: Path) -> List[Dict]:\n        \"\"\"é­”æ³•æ›¸ã‹ã‚‰ã‚¨ãƒ³ãƒˆãƒªã‚’æŠ½å‡º\"\"\"\n        entries = []\n        \n        try:\n            with open(grimoire_path, 'r', encoding='utf-8') as f:\n                content = f.read()\n            \n            # ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã®è¦‹å‡ºã—ã‚’æŠ½å‡º\n            lines = content.split('\\n')\n            current_section = None\n            \n            for line_num, line in enumerate(lines, 1):\n                line = line.strip()\n                \n                # è¦‹å‡ºã—ã®æ¤œå‡º\n                if line.startswith('#'):\n                    level = len(line) - len(line.lstrip('#'))\n                    title = line.lstrip('#').strip()\n                    \n                    if title and level <= 3:  # ãƒ¬ãƒ™ãƒ«3ã¾ã§ç´¢å¼•åŒ–\n                        entry = {\n                            \"title\": title,\n                            \"level\": level,\n                            \"line_number\": line_num,\n                            \"file\": grimoire_path.name,\n                            \"category\": self._categorize_entry(title),\n                            \"content_preview\": self._get_content_preview(lines, line_num)\n                        }\n                        entries.append(entry)\n                        \n                        if level == 1:\n                            current_section = title\n                        elif level == 2 and current_section:\n                            entry[\"parent_section\"] = current_section\n        \n        except Exception as e:\n            logger.error(f\"Error extracting entries from {grimoire_path}: {e}\")\n        \n        return entries\n    \n    def _categorize_entry(self, title: str) -> str:\n        \"\"\"ã‚¨ãƒ³ãƒˆãƒªã®ã‚«ãƒ†ã‚´ãƒªåˆ†é¡\"\"\"\n        title_lower = title.lower()\n        \n        # ã‚«ãƒ†ã‚´ãƒªåˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯\n        if any(word in title_lower for word in ['error', 'exception', 'failed', 'crash']):\n            return 'error_handling'\n        elif any(word in title_lower for word in ['test', 'testing', 'tdd']):\n            return 'testing'\n        elif any(word in title_lower for word in ['performance', 'optimization', 'speed']):\n            return 'performance'\n        elif any(word in title_lower for word in ['config', 'setting', 'setup']):\n            return 'configuration'\n        elif any(word in title_lower for word in ['api', 'endpoint', 'service']):\n            return 'api'\n        elif any(word in title_lower for word in ['database', 'db', 'sql']):\n            return 'database'\n        elif any(word in title_lower for word in ['security', 'auth', 'permission']):\n            return 'security'\n        elif any(word in title_lower for word in ['deployment', 'deploy', 'production']):\n            return 'deployment'\n        else:\n            return 'general'\n    \n    def _get_content_preview(self, lines: List[str], start_line: int) -> str:\n        \"\"\"ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®å–å¾—\"\"\"\n        preview_lines = []\n        \n        # è¦‹å‡ºã—ã®æ¬¡ã®è¡Œã‹ã‚‰æ•°è¡Œã‚’å–å¾—\n        for i in range(start_line, min(start_line + 3, len(lines))):\n            line = lines[i].strip()\n            if line and not line.startswith('#'):\n                preview_lines.append(line)\n        \n        return ' '.join(preview_lines)[:150] + '...' if preview_lines else ''\n    \n    def _create_topic_index(self) -> Dict[str, Any]:\n        \"\"\"ãƒˆãƒ”ãƒƒã‚¯åˆ¥ç´¢å¼•ã®ä½œæˆ\"\"\"\n        topic_index = {\n            \"topics\": {},\n            \"keyword_map\": {},\n            \"related_topics\": {}\n        }\n        \n        # ä¸»è¦ãƒˆãƒ”ãƒƒã‚¯ã®å®šç¾©\n        main_topics = {\n            \"TDD\": [\"test\", \"testing\", \"tdd\", \"unittest\", \"pytest\"],\n            \"Performance\": [\"performance\", \"optimization\", \"speed\", \"memory\", \"cpu\"],\n            \"Error Handling\": [\"error\", \"exception\", \"failed\", \"crash\", \"debug\"],\n            \"Database\": [\"database\", \"db\", \"sql\", \"postgresql\", \"sqlite\"],\n            \"API\": [\"api\", \"endpoint\", \"service\", \"rest\", \"graphql\"],\n            \"Security\": [\"security\", \"auth\", \"permission\", \"token\", \"oauth\"],\n            \"Configuration\": [\"config\", \"setting\", \"setup\", \"environment\", \"env\"],\n            \"Deployment\": [\"deployment\", \"deploy\", \"production\", \"staging\", \"docker\"]\n        }\n        \n        # å„ãƒˆãƒ”ãƒƒã‚¯ã«é–¢é€£ã™ã‚‹ã‚¨ãƒ³ãƒˆãƒªã‚’åé›†\n        for topic_name, keywords in main_topics.items():\n            topic_entries = []\n            \n            for sage_name, grimoire_file in self.grimoire_structure.items():\n                grimoire_path = self.grimoire_base / grimoire_file\n                \n                if grimoire_path.exists():\n                    entries = self._extract_entries_from_grimoire(grimoire_path)\n                    \n                    for entry in entries:\n                        if any(keyword in entry[\"title\"].lower() for keyword in keywords):\n                            topic_entries.append({\n                                \"sage\": sage_name,\n                                \"entry\": entry\n                            })\n            \n            topic_index[\"topics\"][topic_name] = topic_entries\n        \n        return topic_index\n    \n    def _write_index_files(self, master_index: Dict, topic_index: Dict) -> List[str]:\n        \"\"\"ç´¢å¼•ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›¸ãè¾¼ã¿\"\"\"\n        generated_files = []\n        \n        # ãƒã‚¹ã‚¿ãƒ¼ç´¢å¼•ãƒ•ã‚¡ã‚¤ãƒ«\n        master_index_path = self.grimoire_base / \"MASTER_INDEX.md\"\n        with open(master_index_path, 'w', encoding='utf-8') as f:\n            f.write(self._generate_master_index_content(master_index))\n        generated_files.append(str(master_index_path))\n        \n        # ãƒˆãƒ”ãƒƒã‚¯åˆ¥ç´¢å¼•ãƒ•ã‚¡ã‚¤ãƒ«\n        topic_index_path = self.grimoire_base / \"TOPIC_INDEX.md\"\n        with open(topic_index_path, 'w', encoding='utf-8') as f:\n            f.write(self._generate_topic_index_content(topic_index))\n        generated_files.append(str(topic_index_path))\n        \n        # ã‚¯ã‚¤ãƒƒã‚¯ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«\n        quick_ref_path = self.grimoire_base / \"QUICK_REFERENCE.md\"\n        with open(quick_ref_path, 'w', encoding='utf-8') as f:\n            f.write(self._generate_quick_reference_content(master_index, topic_index))\n        generated_files.append(str(quick_ref_path))\n        \n        return generated_files\n    \n    def _generate_master_index_content(self, master_index: Dict) -> str:\n        \"\"\"ãƒã‚¹ã‚¿ãƒ¼ç´¢å¼•ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ç”Ÿæˆ\"\"\"\n        content = f\"\"\"# ğŸ›ï¸ 4è³¢è€…ã‚°ãƒªãƒ¢ã‚¢ ãƒã‚¹ã‚¿ãƒ¼ç´¢å¼•\n\n**æœ€çµ‚æ›´æ–°**: {master_index['last_updated']}\n**ç·ã‚¨ãƒ³ãƒˆãƒªæ•°**: {master_index['total_entries']}\n\n## ğŸ“Š çµ±è¨ˆæƒ…å ±\n\n### è³¢è€…åˆ¥ã‚¨ãƒ³ãƒˆãƒªæ•°\n\"\"\"\n        \n        for sage_name, entries in master_index[\"sage_entries\"].items():\n            content += f\"- **{sage_name}**: {len(entries)}ã‚¨ãƒ³ãƒˆãƒª\\n\"\n        \n        content += \"\\n### ã‚«ãƒ†ã‚´ãƒªåˆ¥åˆ†å¸ƒ\\n\\n\"\n        \n        for category, count in sorted(master_index[\"category_distribution\"].items()):\n            content += f\"- **{category}**: {count}ã‚¨ãƒ³ãƒˆãƒª\\n\"\n        \n        content += \"\\n## ğŸ“š è³¢è€…åˆ¥è©³ç´°ç´¢å¼•\\n\\n\"\n        \n        for sage_name, entries in master_index[\"sage_entries\"].items():\n            content += f\"### {sage_name}\\n\\n\"\n            \n            for entry in entries:\n                content += f\"- **{entry['title']}** (L{entry['level']}) - {entry['file']}:{entry['line_number']}\\n\"\n                if entry.get('content_preview'):\n                    content += f\"  _{entry['content_preview']}_\\n\"\n                content += \"\\n\"\n        \n        return content\n    \n    def _generate_topic_index_content(self, topic_index: Dict) -> str:\n        \"\"\"ãƒˆãƒ”ãƒƒã‚¯åˆ¥ç´¢å¼•ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ç”Ÿæˆ\"\"\"\n        content = f\"\"\"# ğŸ” 4è³¢è€…ã‚°ãƒªãƒ¢ã‚¢ ãƒˆãƒ”ãƒƒã‚¯åˆ¥ç´¢å¼•\n\n**ç”Ÿæˆæ—¥æ™‚**: {datetime.now().isoformat()}\n\n## ğŸ“‹ ä¸»è¦ãƒˆãƒ”ãƒƒã‚¯ä¸€è¦§\n\n\"\"\"\n        \n        for topic_name, entries in topic_index[\"topics\"].items():\n            content += f\"### {topic_name} ({len(entries)}ã‚¨ãƒ³ãƒˆãƒª)\\n\\n\"\n            \n            for item in entries:\n                sage = item[\"sage\"]\n                entry = item[\"entry\"]\n                content += f\"- **{entry['title']}** - {sage} ({entry['file']}:{entry['line_number']})\\n\"\n                if entry.get('content_preview'):\n                    content += f\"  _{entry['content_preview']}_\\n\"\n            \n            content += \"\\n\"\n        \n        return content\n    \n    def _generate_quick_reference_content(self, master_index: Dict, topic_index: Dict) -> str:\n        \"\"\"ã‚¯ã‚¤ãƒƒã‚¯ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ç”Ÿæˆ\"\"\"\n        content = f\"\"\"# âš¡ 4è³¢è€…ã‚°ãƒªãƒ¢ã‚¢ ã‚¯ã‚¤ãƒƒã‚¯ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹\n\n**ç”Ÿæˆæ—¥æ™‚**: {datetime.now().isoformat()}\n\n## ğŸš€ ã‚ˆãä½¿ç”¨ã•ã‚Œã‚‹é …ç›®\n\n### ã‚¨ãƒ©ãƒ¼å¯¾å¿œ\n\"\"\"\n        \n        # ã‚¨ãƒ©ãƒ¼é–¢é€£ã®é …ç›®ã‚’æŠ½å‡º\n        error_entries = []\n        for sage_name, entries in master_index[\"sage_entries\"].items():\n            for entry in entries:\n                if entry[\"category\"] == \"error_handling\":\n                    error_entries.append((sage_name, entry))\n        \n        for sage_name, entry in error_entries[:5]:  # ä¸Šä½5ä»¶\n            content += f\"- **{entry['title']}** - {sage_name}\\n\"\n        \n        content += \"\\n### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–\\n\\n\"\n        \n        # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹é–¢é€£ã®é …ç›®ã‚’æŠ½å‡º\n        perf_entries = []\n        for sage_name, entries in master_index[\"sage_entries\"].items():\n            for entry in entries:\n                if entry[\"category\"] == \"performance\":\n                    perf_entries.append((sage_name, entry))\n        \n        for sage_name, entry in perf_entries[:5]:  # ä¸Šä½5ä»¶\n            content += f\"- **{entry['title']}** - {sage_name}\\n\"\n        \n        content += \"\\n### TDDãƒ»ãƒ†ã‚¹ãƒˆ\\n\\n\"\n        \n        # ãƒ†ã‚¹ãƒˆé–¢é€£ã®é …ç›®ã‚’æŠ½å‡º\n        test_entries = []\n        for sage_name, entries in master_index[\"sage_entries\"].items():\n            for entry in entries:\n                if entry[\"category\"] == \"testing\":\n                    test_entries.append((sage_name, entry))\n        \n        for sage_name, entry in test_entries[:5]:  # ä¸Šä½5ä»¶\n            content += f\"- **{entry['title']}** - {sage_name}\\n\"\n        \n        content += \"\\n## ğŸ”— è³¢è€…é–“ç›¸äº’å‚ç…§\\n\\n\"\n        content += \"- **ãƒŠãƒ¬ãƒƒã‚¸è³¢è€…** â†” **RAGè³¢è€…**: çŸ¥è­˜æ¤œç´¢ã¨çµ±åˆ\\n\"\n        content += \"- **ã‚¿ã‚¹ã‚¯è³¢è€…** â†” **ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆè³¢è€…**: å•é¡Œå¯¾å¿œã¨é€²æ—ç®¡ç†\\n\"\n        content += \"- **å…¨è³¢è€…** â†” **å…±é€šçŸ¥è­˜**: åŸºæœ¬ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¨éšå±¤æ§‹é€ \\n\"\n        \n        return content\n    \n    def _create_cross_reference_system(self) -> Dict[str, Any]:\n        \"\"\"ç›¸äº’å‚ç…§ã‚·ã‚¹ãƒ†ãƒ ã®ä½œæˆ\"\"\"\n        print(\"  ğŸ”— ç›¸äº’å‚ç…§ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ä¸­...\")\n        \n        cross_ref_result = {\n            \"status\": \"creating\",\n            \"cross_references\": {},\n            \"related_topics\": {},\n            \"navigation_links\": []\n        }\n        \n        try:\n            # å„é­”æ³•æ›¸ã«ç›¸äº’å‚ç…§ãƒªãƒ³ã‚¯ã‚’è¿½åŠ \n            for sage_name, grimoire_file in self.grimoire_structure.items():\n                grimoire_path = self.grimoire_base / grimoire_file\n                \n                if grimoire_path.exists():\n                    self._add_cross_references_to_grimoire(grimoire_path, sage_name)\n            \n            cross_ref_result[\"status\"] = \"completed\"\n            self.enhancement_phases[\"cross_referencing\"] = True\n            \n        except Exception as e:\n            cross_ref_result[\"status\"] = \"failed\"\n            cross_ref_result[\"error\"] = str(e)\n        \n        self._log_enhancement(\"Cross-reference system\", cross_ref_result[\"status\"])\n        return cross_ref_result\n    \n    def _add_cross_references_to_grimoire(self, grimoire_path: Path, sage_name: str):\n        \"\"\"é­”æ³•æ›¸ã«ç›¸äº’å‚ç…§ã‚’è¿½åŠ \"\"\"\n        try:\n            with open(grimoire_path, 'r', encoding='utf-8') as f:\n                content = f.read()\n            \n            # ç›¸äº’å‚ç…§ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒãªã„å ´åˆã¯è¿½åŠ \n            if \"## ğŸ”— é–¢é€£ã™ã‚‹è³¢è€…ã®çŸ¥è­˜\" not in content:\n                cross_ref_section = self._generate_cross_reference_section(sage_name)\n                content += \"\\n\\n\" + cross_ref_section\n                \n                with open(grimoire_path, 'w', encoding='utf-8') as f:\n                    f.write(content)\n            \n        except Exception as e:\n            logger.error(f\"Error adding cross-references to {grimoire_path}: {e}\")\n    \n    def _generate_cross_reference_section(self, sage_name: str) -> str:\n        \"\"\"ç›¸äº’å‚ç…§ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ç”Ÿæˆ\"\"\"\n        cross_refs = {\n            \"knowledge_sage\": [\n                \"ğŸ“‹ **ã‚¿ã‚¹ã‚¯è³¢è€…**: å­¦ç¿’ã‚¿ã‚¹ã‚¯ã®ç®¡ç†ã¨é€²æ—è¿½è·¡\",\n                \"ğŸ” **RAGè³¢è€…**: çŸ¥è­˜æ¤œç´¢ã¨æƒ…å ±çµ±åˆ\",\n                \"ğŸš¨ **ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆè³¢è€…**: å­¦ç¿’å¤±æ•—ã®è¨˜éŒ²ã¨å¯¾ç­–\"\n            ],\n            \"task_oracle\": [\n                \"ğŸ“š **ãƒŠãƒ¬ãƒƒã‚¸è³¢è€…**: ã‚¿ã‚¹ã‚¯å®Ÿè¡Œã®ãŸã‚ã®çŸ¥è­˜å‚ç…§\",\n                \"ğŸ” **RAGè³¢è€…**: ã‚¿ã‚¹ã‚¯æƒ…å ±ã®æ¤œç´¢ã¨åˆ†æ\",\n                \"ğŸš¨ **ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆè³¢è€…**: ã‚¿ã‚¹ã‚¯å¤±æ•—ã®å¯¾å¿œã¨å­¦ç¿’\"\n            ],\n            \"incident_sage\": [\n                \"ğŸ“š **ãƒŠãƒ¬ãƒƒã‚¸è³¢è€…**: ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œã®çŸ¥è­˜è“„ç©\",\n                \"ğŸ“‹ **ã‚¿ã‚¹ã‚¯è³¢è€…**: å¾©æ—§ã‚¿ã‚¹ã‚¯ã®ç®¡ç†ã¨è¿½è·¡\",\n                \"ğŸ” **RAGè³¢è€…**: é¡ä¼¼ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã®æ¤œç´¢ã¨åˆ†æ\"\n            ],\n            \"rag_mystic\": [\n                \"ğŸ“š **ãƒŠãƒ¬ãƒƒã‚¸è³¢è€…**: æ¤œç´¢çµæœã®çŸ¥è­˜åŒ–ã¨è“„ç©\",\n                \"ğŸ“‹ **ã‚¿ã‚¹ã‚¯è³¢è€…**: æ¤œç´¢ã‚¿ã‚¹ã‚¯ã®åŠ¹ç‡åŒ–\",\n                \"ğŸš¨ **ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆè³¢è€…**: æ¤œç´¢å¤±æ•—ã®åˆ†æã¨æ”¹å–„\"\n            ]\n        }\n        \n        section = \"## ğŸ”— é–¢é€£ã™ã‚‹è³¢è€…ã®çŸ¥è­˜\\n\\n\"\n        \n        if sage_name in cross_refs:\n            for ref in cross_refs[sage_name]:\n                section += f\"- {ref}\\n\"\n        \n        section += \"\\n### ğŸ“Š å…±é€šãƒ—ãƒ­ãƒˆã‚³ãƒ«\\n\\n\"\n        section += \"- **00_common_knowledge.md**: 4è³¢è€…å…±é€šã®åŸºæœ¬çŸ¥è­˜\\n\"\n        section += \"- **MASTER_INDEX.md**: å…¨é­”æ³•æ›¸ã®çµ±åˆç´¢å¼•\\n\"\n        section += \"- **TOPIC_INDEX.md**: ãƒˆãƒ”ãƒƒã‚¯åˆ¥çŸ¥è­˜ç´¢å¼•\\n\"\n        section += \"- **QUICK_REFERENCE.md**: ã‚ˆãä½¿ç”¨ã•ã‚Œã‚‹çŸ¥è­˜\\n\"\n        \n        return section\n    \n    def _optimize_search_functionality(self) -> Dict[str, Any]:\n        \"\"\"æ¤œç´¢æ©Ÿèƒ½æœ€é©åŒ–\"\"\"\n        print(\"  ğŸ” æ¤œç´¢æ©Ÿèƒ½ã‚’æœ€é©åŒ–ä¸­...\")\n        \n        search_result = {\n            \"status\": \"optimizing\",\n            \"search_tools\": [],\n            \"improvements\": []\n        }\n        \n        try:\n            # æ¤œç´¢ãƒ„ãƒ¼ãƒ«ã®ä½œæˆ\n            search_tools = self._create_search_tools()\n            search_result[\"search_tools\"] = search_tools\n            \n            search_result[\"status\"] = \"completed\"\n            self.enhancement_phases[\"search_optimization\"] = True\n            \n        except Exception as e:\n            search_result[\"status\"] = \"failed\"\n            search_result[\"error\"] = str(e)\n        \n        self._log_enhancement(\"Search optimization\", search_result[\"status\"])\n        return search_result\n    \n    def _create_search_tools(self) -> List[str]:\n        \"\"\"æ¤œç´¢ãƒ„ãƒ¼ãƒ«ã®ä½œæˆ\"\"\"\n        tools = []\n        \n        # æ¤œç´¢ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½œæˆ\n        search_script_path = self.project_root / \"scripts\" / \"grimoire_search.py\"\n        with open(search_script_path, 'w', encoding='utf-8') as f:\n            f.write(self._generate_search_script_content())\n        tools.append(str(search_script_path))\n        \n        # æ¤œç´¢è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ\n        search_config_path = self.project_root / \"config\" / \"grimoire_search_config.json\"\n        search_config_path.parent.mkdir(exist_ok=True)\n        \n        search_config = {\n            \"grimoire_paths\": {\n                sage: str(self.grimoire_base / file)\n                for sage, file in self.grimoire_structure.items()\n            },\n            \"search_options\": {\n                \"case_sensitive\": False,\n                \"whole_word\": False,\n                \"regex_enabled\": True,\n                \"max_results\": 50\n            },\n            \"index_files\": {\n                \"master_index\": str(self.grimoire_base / \"MASTER_INDEX.md\"),\n                \"topic_index\": str(self.grimoire_base / \"TOPIC_INDEX.md\"),\n                \"quick_reference\": str(self.grimoire_base / \"QUICK_REFERENCE.md\")\n            }\n        }\n        \n        with open(search_config_path, 'w', encoding='utf-8') as f:\n            json.dump(search_config, f, indent=2, ensure_ascii=False)\n        tools.append(str(search_config_path))\n        \n        return tools\n    \n    def _generate_search_script_content(self) -> str:\n        \"\"\"æ¤œç´¢ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ç”Ÿæˆ\"\"\"\n        return '''#!/usr/bin/env python3\n\"\"\"\n4è³¢è€…ã‚°ãƒªãƒ¢ã‚¢æ¤œç´¢ãƒ„ãƒ¼ãƒ«\n\"\"\"\n\nimport sys\nimport json\nimport re\nfrom pathlib import Path\n\ndef search_grimoires(query, options=None):\n    \"\"\"ã‚°ãƒªãƒ¢ã‚¢æ¤œç´¢\"\"\"\n    if options is None:\n        options = {\"case_sensitive\": False, \"whole_word\": False, \"regex_enabled\": True}\n    \n    # æ¤œç´¢å®Ÿè£…\n    results = []\n    \n    # æ¤œç´¢çµæœã®æ§‹é€ \n    # {\n    #     \"file\": \"grimoire_file.md\",\n    #     \"line_number\": 123,\n    #     \"content\": \"ãƒãƒƒãƒã—ãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„\",\n    #     \"context\": \"å‰å¾Œã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ\"\n    # }\n    \n    return results\n\nif __name__ == \"__main__\":\n    if len(sys.argv) < 2:\n        print(\"ä½¿ç”¨æ³•: python grimoire_search.py <æ¤œç´¢ã‚¯ã‚¨ãƒª> [ã‚ªãƒ—ã‚·ãƒ§ãƒ³]\")\n        sys.exit(1)\n    \n    query = sys.argv[1]\n    results = search_grimoires(query)\n    \n    if results:\n        print(f\"æ¤œç´¢çµæœ: {len(results)}ä»¶\")\n        for result in results:\n            print(f\"- {result['file']}:{result['line_number']} - {result['content']}\")\n    else:\n        print(\"æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚\")\n'''\n    \n    def _improve_navigation(self) -> Dict[str, Any]:\n        \"\"\"ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ”¹å–„\"\"\"\n        print(\"  ğŸ§­ ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ”¹å–„ä¸­...\")\n        \n        nav_result = {\n            \"status\": \"improving\",\n            \"navigation_files\": [],\n            \"improvements\": []\n        }\n        \n        try:\n            # ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ\n            nav_files = self._create_navigation_files()\n            nav_result[\"navigation_files\"] = nav_files\n            \n            nav_result[\"status\"] = \"completed\"\n            self.enhancement_phases[\"navigation_improvement\"] = True\n            \n        except Exception as e:\n            nav_result[\"status\"] = \"failed\"\n            nav_result[\"error\"] = str(e)\n        \n        self._log_enhancement(\"Navigation improvement\", nav_result[\"status\"])\n        return nav_result\n    \n    def _create_navigation_files(self) -> List[str]:\n        \"\"\"ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ\"\"\"\n        nav_files = []\n        \n        # README.mdã®ä½œæˆ\n        readme_path = self.grimoire_base / \"README.md\"\n        with open(readme_path, 'w', encoding='utf-8') as f:\n            f.write(self._generate_readme_content())\n        nav_files.append(str(readme_path))\n        \n        return nav_files\n    \n    def _generate_readme_content(self) -> str:\n        \"\"\"README.mdã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ç”Ÿæˆ\"\"\"\n        return f'''# ğŸ›ï¸ 4è³¢è€…ã‚°ãƒªãƒ¢ã‚¢ - ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¬ã‚¤ãƒ‰\n\n**æœ€çµ‚æ›´æ–°**: {datetime.now().isoformat()}\n\n## ğŸ§™â€â™‚ï¸ 4è³¢è€…ã®é­”æ³•æ›¸\n\n### ğŸ“š **ãƒŠãƒ¬ãƒƒã‚¸è³¢è€… (Knowledge Sage)**\n- **ãƒ•ã‚¡ã‚¤ãƒ«**: `01_knowledge_sage_grimoire.md`\n- **å½¹å‰²**: éå»ã®è‹±çŸ¥ã‚’è“„ç©ãƒ»ç¶™æ‰¿ã€å­¦ç¿’ã«ã‚ˆã‚‹çŸ¥æµã®é€²åŒ–\n- **ä¸»ãªå†…å®¹**: å­¦ç¿’ãƒ‘ã‚¿ãƒ¼ãƒ³ã€çŸ¥è­˜çµ±åˆã€çµŒé¨“ã®è“„ç©\n\n### ğŸ“‹ **ã‚¿ã‚¹ã‚¯è³¢è€… (Task Oracle)**\n- **ãƒ•ã‚¡ã‚¤ãƒ«**: `02_task_oracle_grimoire.md`\n- **å½¹å‰²**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé€²æ—ç®¡ç†ã€æœ€é©ãªå®Ÿè¡Œé †åºã®å°å‡º\n- **ä¸»ãªå†…å®¹**: ã‚¿ã‚¹ã‚¯ç®¡ç†ã€å„ªå…ˆé †ä½ä»˜ã‘ã€é€²æ—è¿½è·¡\n\n### ğŸš¨ **ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆè³¢è€… (Crisis Sage)**\n- **ãƒ•ã‚¡ã‚¤ãƒ«**: `03_incident_sage_grimoire.md`\n- **å½¹å‰²**: å±æ©Ÿå¯¾å¿œå°‚é–€å®¶ã€å•é¡Œã®å³åº§æ„ŸçŸ¥ãƒ»è§£æ±º\n- **ä¸»ãªå†…å®¹**: ã‚¨ãƒ©ãƒ¼å¯¾å¿œã€éšœå®³å¾©æ—§ã€äºˆé˜²ç­–\n\n### ğŸ” **RAGè³¢è€… (Search Mystic)**\n- **ãƒ•ã‚¡ã‚¤ãƒ«**: `04_rag_mystic_grimoire.md`\n- **å½¹å‰²**: æƒ…å ±æ¢ç´¢ã¨ç†è§£ã€è†¨å¤§ãªçŸ¥è­˜ã‹ã‚‰æœ€é©è§£ç™ºè¦‹\n- **ä¸»ãªå†…å®¹**: æ¤œç´¢æŠ€è¡“ã€æƒ…å ±çµ±åˆã€çŸ¥è­˜ç™ºè¦‹\n\n### ğŸŒŸ **å…±é€šçŸ¥è­˜**\n- **ãƒ•ã‚¡ã‚¤ãƒ«**: `00_common_knowledge.md`\n- **å½¹å‰²**: 4è³¢è€…å…±é€šã®åŸºæœ¬çŸ¥è­˜ã¨ãƒ—ãƒ­ãƒˆã‚³ãƒ«\n- **ä¸»ãªå†…å®¹**: éšå±¤æ§‹é€ ã€åŸºæœ¬ãƒ«ãƒ¼ãƒ«ã€å…±é€šæ‰‹é †\n\n## ğŸ“– ç´¢å¼•ãƒ»å‚ç…§ãƒ•ã‚¡ã‚¤ãƒ«\n\n### ğŸ“š **MASTER_INDEX.md**\n- å…¨é­”æ³•æ›¸ã®çµ±åˆç´¢å¼•\n- è³¢è€…åˆ¥ãƒ»ã‚«ãƒ†ã‚´ãƒªåˆ¥ã‚¨ãƒ³ãƒˆãƒªä¸€è¦§\n- è©³ç´°ãªå†…å®¹ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼\n\n### ğŸ” **TOPIC_INDEX.md**\n- ãƒˆãƒ”ãƒƒã‚¯åˆ¥çŸ¥è­˜ç´¢å¼•\n- ä¸»è¦ãƒ†ãƒ¼ãƒã”ã¨ã®é–¢é€£ã‚¨ãƒ³ãƒˆãƒª\n- æ¨ªæ–­çš„ãªçŸ¥è­˜å‚ç…§\n\n### âš¡ **QUICK_REFERENCE.md**\n- ã‚ˆãä½¿ç”¨ã•ã‚Œã‚‹çŸ¥è­˜ã®ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹\n- ã‚¨ãƒ©ãƒ¼å¯¾å¿œã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã€TDD\n- è³¢è€…é–“ã®ç›¸äº’å‚ç…§\n\n## ğŸ”§ æ¤œç´¢ãƒ»ã‚¢ã‚¯ã‚»ã‚¹ãƒ„ãƒ¼ãƒ«\n\n### æ¤œç´¢æ©Ÿèƒ½\n```bash\n# ã‚°ãƒªãƒ¢ã‚¢æ¤œç´¢\npython scripts/grimoire_search.py \"æ¤œç´¢ã‚¯ã‚¨ãƒª\"\n\n# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«\nconfig/grimoire_search_config.json\n```\n\n### ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹\n- **ã‚¨ãƒ©ãƒ¼å¯¾å¿œ**: `grep -n \"error\\|exception\\|failed\" *.md`\n- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: `grep -n \"performance\\|optimization\" *.md`\n- **TDD**: `grep -n \"test\\|tdd\\|unittest\" *.md`\n\n## ğŸ¯ ä½¿ç”¨æ–¹æ³•\n\n1. **å•é¡Œè§£æ±º**: ã¾ãšQUICK_REFERENCE.mdã‚’ç¢ºèª\n2. **è©³ç´°èª¿æŸ»**: è©²å½“ã™ã‚‹è³¢è€…ã®ã‚°ãƒªãƒ¢ã‚¢ã‚’å‚ç…§\n3. **æ¨ªæ–­æ¤œç´¢**: TOPIC_INDEX.mdã§ãƒˆãƒ”ãƒƒã‚¯åˆ¥æ¤œç´¢\n4. **åŒ…æ‹¬æ¤œç´¢**: MASTER_INDEX.mdã§å…¨ä½“ã‹ã‚‰æ¤œç´¢\n\n## ğŸ”— è³¢è€…é–“ã®é€£æº\n\n- **å•é¡Œç™ºç”Ÿæ™‚**: ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆè³¢è€… â†’ ä»–è³¢è€…ã¸ã®ç›¸è«‡\n- **å­¦ç¿’æ™‚**: ãƒŠãƒ¬ãƒƒã‚¸è³¢è€… â†’ RAGè³¢è€…ã§ã®æƒ…å ±åé›†\n- **ã‚¿ã‚¹ã‚¯å®Ÿè¡Œæ™‚**: ã‚¿ã‚¹ã‚¯è³¢è€… â†’ å„è³¢è€…ã®å°‚é–€çŸ¥è­˜å‚ç…§\n\n---\n\n**ğŸ’¡ ãƒ’ãƒ³ãƒˆ**: è¿·ã£ãŸã¨ãã¯å…±é€šçŸ¥è­˜ï¼ˆ00_common_knowledge.mdï¼‰ã‹ã‚‰å§‹ã‚ã‚ˆã†ï¼\n'''\n    \n    def _create_quick_access_tools(self) -> Dict[str, Any]:\n        \"\"\"ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãƒ„ãƒ¼ãƒ«ã®ä½œæˆ\"\"\"\n        print(\"  âš¡ ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãƒ„ãƒ¼ãƒ«ã‚’ä½œæˆä¸­...\")\n        \n        tools_result = {\n            \"status\": \"creating\",\n            \"tools\": [],\n            \"shortcuts\": []\n        }\n        \n        try:\n            # ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½œæˆ\n            tools = self._create_quick_access_scripts()\n            tools_result[\"tools\"] = tools\n            \n            tools_result[\"status\"] = \"completed\"\n            self.enhancement_phases[\"quick_access_tools\"] = True\n            \n        except Exception as e:\n            tools_result[\"status\"] = \"failed\"\n            tools_result[\"error\"] = str(e)\n        \n        self._log_enhancement(\"Quick access tools\", tools_result[\"status\"])\n        return tools_result\n    \n    def _create_quick_access_scripts(self) -> List[str]:\n        \"\"\"ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½œæˆ\"\"\"\n        tools = []\n        \n        # ã‚¯ã‚¤ãƒƒã‚¯ãƒ˜ãƒ«ãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ\n        help_script_path = self.project_root / \"scripts\" / \"grimoire_help.py\"\n        with open(help_script_path, 'w', encoding='utf-8') as f:\n            f.write(self._generate_help_script_content())\n        tools.append(str(help_script_path))\n        \n        return tools\n    \n    def _generate_help_script_content(self) -> str:\n        \"\"\"ãƒ˜ãƒ«ãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ç”Ÿæˆ\"\"\"\n        return '''#!/usr/bin/env python3\n\"\"\"\n4è³¢è€…ã‚°ãƒªãƒ¢ã‚¢ ã‚¯ã‚¤ãƒƒã‚¯ãƒ˜ãƒ«ãƒ—\n\"\"\"\n\nimport sys\nfrom pathlib import Path\n\ndef show_help(topic=None):\n    \"\"\"ãƒ˜ãƒ«ãƒ—è¡¨ç¤º\"\"\"\n    if topic is None:\n        print(\"ğŸ›ï¸ 4è³¢è€…ã‚°ãƒªãƒ¢ã‚¢ - ã‚¯ã‚¤ãƒƒã‚¯ãƒ˜ãƒ«ãƒ—\")\n        print(\"=\" * 50)\n        print(\"ä½¿ç”¨æ³•: python grimoire_help.py [ãƒˆãƒ”ãƒƒã‚¯]\")\n        print(\"\")\n        print(\"ğŸ“š åˆ©ç”¨å¯èƒ½ãªãƒˆãƒ”ãƒƒã‚¯:\")\n        print(\"- sages: 4è³¢è€…ã®æ¦‚è¦\")\n        print(\"- files: ã‚°ãƒªãƒ¢ã‚¢ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§\")\n        print(\"- search: æ¤œç´¢æ–¹æ³•\")\n        print(\"- index: ç´¢å¼•ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½¿ã„æ–¹\")\n        print(\"- navigation: ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ–¹æ³•\")\n        print(\"\")\n        print(\"ä¾‹: python grimoire_help.py sages\")\n    \n    elif topic == \"sages\":\n        print(\"ğŸ§™â€â™‚ï¸ 4è³¢è€…ã®æ¦‚è¦\")\n        print(\"=\" * 30)\n        print(\"ğŸ“š ãƒŠãƒ¬ãƒƒã‚¸è³¢è€…: çŸ¥è­˜ã®è“„ç©ã¨ç¶™æ‰¿\")\n        print(\"ğŸ“‹ ã‚¿ã‚¹ã‚¯è³¢è€…: é€²æ—ç®¡ç†ã¨å®Ÿè¡Œé †åº\")\n        print(\"ğŸš¨ ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆè³¢è€…: å•é¡Œå¯¾å¿œã¨å¾©æ—§\")\n        print(\"ğŸ” RAGè³¢è€…: æƒ…å ±æ¤œç´¢ã¨çµ±åˆ\")\n    \n    elif topic == \"files\":\n        print(\"ğŸ“ ã‚°ãƒªãƒ¢ã‚¢ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§\")\n        print(\"=\" * 30)\n        print(\"00_common_knowledge.md - å…±é€šçŸ¥è­˜\")\n        print(\"01_knowledge_sage_grimoire.md - ãƒŠãƒ¬ãƒƒã‚¸è³¢è€…\")\n        print(\"02_task_oracle_grimoire.md - ã‚¿ã‚¹ã‚¯è³¢è€…\")\n        print(\"03_incident_sage_grimoire.md - ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆè³¢è€…\")\n        print(\"04_rag_mystic_grimoire.md - RAGè³¢è€…\")\n        print(\"\")\n        print(\"ğŸ“– ç´¢å¼•ãƒ•ã‚¡ã‚¤ãƒ«:\")\n        print(\"MASTER_INDEX.md - çµ±åˆç´¢å¼•\")\n        print(\"TOPIC_INDEX.md - ãƒˆãƒ”ãƒƒã‚¯åˆ¥ç´¢å¼•\")\n        print(\"QUICK_REFERENCE.md - ã‚¯ã‚¤ãƒƒã‚¯ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹\")\n        print(\"README.md - ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¬ã‚¤ãƒ‰\")\n    \n    else:\n        print(f\"âŒ ä¸æ˜ãªãƒˆãƒ”ãƒƒã‚¯: {topic}\")\n        print(\"åˆ©ç”¨å¯èƒ½ãªãƒˆãƒ”ãƒƒã‚¯: sages, files, search, index, navigation\")\n\nif __name__ == \"__main__\":\n    topic = sys.argv[1] if len(sys.argv) > 1 else None\n    show_help(topic)\n'''\n    \n    def _assess_enhancement_status(self) -> str:\n        \"\"\"æ”¹å–„çŠ¶æ³ã®è©•ä¾¡\"\"\"\n        completed_phases = sum(self.enhancement_phases.values())\n        total_phases = len(self.enhancement_phases)\n        \n        if completed_phases == total_phases:\n            return \"fully_enhanced\"\n        elif completed_phases >= total_phases * 0.8:\n            return \"mostly_enhanced\"\n        elif completed_phases >= total_phases * 0.5:\n            return \"partially_enhanced\"\n        else:\n            return \"needs_enhancement\"\n    \n    def _collect_improvements(self) -> List[str]:\n        \"\"\"æ”¹å–„é …ç›®ã®åé›†\"\"\"\n        improvements = []\n        \n        if self.enhancement_phases[\"index_generation\"]:\n            improvements.append(\"ğŸ“š çµ±åˆç´¢å¼•ã‚·ã‚¹ãƒ†ãƒ ã®æ§‹ç¯‰\")\n        \n        if self.enhancement_phases[\"cross_referencing\"]:\n            improvements.append(\"ğŸ”— è³¢è€…é–“ç›¸äº’å‚ç…§ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…\")\n        \n        if self.enhancement_phases[\"search_optimization\"]:\n            improvements.append(\"ğŸ” æ¤œç´¢æ©Ÿèƒ½ã®æœ€é©åŒ–\")\n        \n        if self.enhancement_phases[\"navigation_improvement\"]:\n            improvements.append(\"ğŸ§­ ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã®æ”¹å–„\")\n        \n        if self.enhancement_phases[\"quick_access_tools\"]:\n            improvements.append(\"âš¡ ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãƒ„ãƒ¼ãƒ«ã®æä¾›\")\n        \n        return improvements\n    \n    def _calculate_metrics(self) -> Dict[str, Any]:\n        \"\"\"ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®è¨ˆç®—\"\"\"\n        metrics = {\n            \"total_grimoires\": len(self.grimoire_structure),\n            \"enhancement_completion\": sum(self.enhancement_phases.values()) / len(self.enhancement_phases) * 100,\n            \"generated_files\": 0,\n            \"total_entries\": 0\n        }\n        \n        # ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ\n        generated_files = [\n            \"MASTER_INDEX.md\",\n            \"TOPIC_INDEX.md\",\n            \"QUICK_REFERENCE.md\",\n            \"README.md\"\n        ]\n        \n        for file_name in generated_files:\n            file_path = self.grimoire_base / file_name\n            if file_path.exists():\n                metrics[\"generated_files\"] += 1\n        \n        return metrics\n    \n    def _log_enhancement(self, phase_name: str, status: str):\n        \"\"\"æ”¹å–„ãƒ­ã‚°ã®è¨˜éŒ²\"\"\"\n        timestamp = datetime.now().isoformat()\n        log_entry = f\"[{timestamp}] {phase_name}: {status}\\n\"\n        \n        with open(self.access_log, 'a', encoding='utf-8') as f:\n            f.write(log_entry)\n\ndef main():\n    \"\"\"ãƒ¡ã‚¤ãƒ³å‡¦ç†\"\"\"\n    enhancer = GrimoireAccessibilityEnhancer()\n    \n    print(\"ğŸš€ ã‚°ãƒªãƒ¢ã‚¢ã‚¢ã‚¯ã‚»ã‚¹æ€§å‘ä¸Šã‚·ã‚¹ãƒ†ãƒ \")\n    print(\"=\" * 60)\n    \n    # ã‚¢ã‚¯ã‚»ã‚¹æ€§å‘ä¸Šã®å®Ÿè¡Œ\n    enhancement_results = enhancer.enhance_accessibility()\n    \n    # çµæœè¡¨ç¤º\n    print(f\"\\nğŸ“Š æ”¹å–„çµæœã‚µãƒãƒªãƒ¼\")\n    print(\"-\" * 40)\n    print(f\"ç·åˆçŠ¶æ³: {enhancement_results['overall_status'].upper()}\")\n    print(f\"å®Œäº†ãƒ•ã‚§ãƒ¼ã‚º: {sum(enhancer.enhancement_phases.values())}/{len(enhancer.enhancement_phases)}\")\n    print(f\"æ”¹å–„å®Œäº†ç‡: {enhancement_results['metrics']['enhancement_completion']:.1f}%\")\n    \n    # ãƒ•ã‚§ãƒ¼ã‚ºåˆ¥è©³ç´°\n    print(f\"\\nğŸ” ãƒ•ã‚§ãƒ¼ã‚ºåˆ¥çŠ¶æ³\")\n    print(\"-\" * 40)\n    for phase_name, result in enhancement_results[\"phases\"].items():\n        status_icon = \"âœ…\" if result[\"status\"] == \"completed\" else \"âŒ\"\n        print(f\"{status_icon} {phase_name}: {result['status'].upper()}\")\n    \n    # å®Ÿè£…ã•ã‚ŒãŸæ”¹å–„é …ç›®\n    print(f\"\\nğŸ’¡ å®Ÿè£…ã•ã‚ŒãŸæ”¹å–„é …ç›®\")\n    print(\"-\" * 40)\n    for i, improvement in enumerate(enhancement_results[\"improvements\"], 1):\n        print(f\"{i}. {improvement}\")\n    \n    # ãƒ¡ãƒˆãƒªã‚¯ã‚¹\n    metrics = enhancement_results[\"metrics\"]\n    print(f\"\\nğŸ“ˆ ãƒ¡ãƒˆãƒªã‚¯ã‚¹\")\n    print(\"-\" * 40)\n    print(f\"ã‚°ãƒªãƒ¢ã‚¢æ•°: {metrics['total_grimoires']}\")\n    print(f\"ç”Ÿæˆãƒ•ã‚¡ã‚¤ãƒ«æ•°: {metrics['generated_files']}\")\n    print(f\"æ”¹å–„å®Œäº†ç‡: {metrics['enhancement_completion']:.1f}%\")\n    \n    # è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆä¿å­˜\n    report_file = PROJECT_ROOT / \"logs\" / f\"grimoire_accessibility_{datetime.now().strftime('%Y%m%d_%H%M%S')}.json\"\n    with open(report_file, 'w', encoding='utf-8') as f:\n        json.dump(enhancement_results, f, indent=2, ensure_ascii=False, default=str)\n    \n    print(f\"\\nğŸ’¾ è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸ: {report_file}\")\n    \n    # ä½¿ç”¨æ–¹æ³•ã®æ¡ˆå†…\n    print(f\"\\nğŸ¯ ä½¿ç”¨æ–¹æ³•\")\n    print(\"-\" * 40)\n    print(\"1. README.md ã§ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¬ã‚¤ãƒ‰ã‚’ç¢ºèª\")\n    print(\"2. QUICK_REFERENCE.md ã§ã‚ˆãä½¿ç”¨ã•ã‚Œã‚‹çŸ¥è­˜ã‚’ãƒã‚§ãƒƒã‚¯\")\n    print(\"3. python scripts/grimoire_help.py ã§ãƒ˜ãƒ«ãƒ—ã‚’è¡¨ç¤º\")\n    print(\"4. python scripts/grimoire_search.py <ã‚¯ã‚¨ãƒª> ã§æ¤œç´¢\")\n\nif __name__ == \"__main__\":\n    main()