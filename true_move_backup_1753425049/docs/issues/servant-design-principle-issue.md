# 🏛️ 新エルダーズギルド サーバント設計原則の確立と適用

**Issue Type**: 📋 設計方針・アーキテクチャ  
**Priority**: Critical  
**Assignee**: Claude Elder + All Servant Developers  
**Milestone**: 新エルダーズギルド基盤確立  

---

## 🎯 Issue概要

**エルダーサーバントの設計において「1サーバント1コマンド」原則を確立し、実行と判定の完全分離によりハルシネーションを防止する**

### 🔑 核心コンセプト
```
サーバント = MCPツールを1つ呼ぶようなイメージ
- 実行はしない（エンジンの仕事）
- 判定だけする（サーバントの仕事）
- 1つのコマンドに特化（責任の明確化）
```

---

## 📋 実装要件

### 1. **設計原則の適用**
- [ ] 全新規サーバントは「1サーバント1コマンド」原則に従う
- [ ] 既存サーバントの段階的リファクタリング
- [ ] 標準テンプレートの使用義務化

### 2. **3層アーキテクチャの確立**
```yaml
エンジン層（実行）:
  - コマンド実行のみ
  - 判断ゼロ
  - 例: pylint実行、pytest実行

サーバント層（判定）:
  - 結果判定のみ
  - 実行ゼロ
  - 例: スコア判定、次アクション指示

A2A層（調整）:
  - フロー制御のみ
  - 創造ゼロ
  - 例: サーバント指示の実行
```

### 3. **標準実装パターン**
```python
# 良い例
class PylintServant:
    def __init__(self):
        self.command = "pylint"  # 1コマンドのみ
    
    async def judge(self, result):
        if result.score < 9.5:
            return {"verdict": "RETRY", "command": "pylint --fix"}
        return {"verdict": "APPROVED"}
```

---

## 🚫 アンチパターン（禁止事項）

1. **実行と判定の混在**
   - サーバント内でのコマンド実行
   - 副作用を持つ処理

2. **複数責任の保持**
   - 1サーバントが複数コマンドを管理
   - 判定以外の処理を実装

3. **創造的判断**
   - 定義外の新しい解決策を提案
   - ルールにない判定基準の追加

---

## 📊 期待成果

### 技術的効果
- **ハルシネーション発生率**: 90%削減
- **コード保守性**: 200%向上
- **テスト容易性**: 純粋関数により300%向上
- **拡張性**: 新サーバント追加時間80%削減

### 運用効果
- **エラー原因特定時間**: 70%削減
- **サーバント開発時間**: 50%削減
- **品質一貫性**: 100%保証

---

## 🔄 実装フェーズ

### Phase 1: 原則確立（完了）
- [x] 設計原則文書作成
- [x] 標準テンプレート定義
- [x] アンチパターン定義

### Phase 2: 新規実装適用（進行中）
- [ ] Issue #309 品質パイプラインへの適用
- [ ] 新規サーバントでの原則遵守
- [ ] コードレビュー基準への組み込み

### Phase 3: 既存改修（計画中）
- [ ] 既存サーバントの影響分析
- [ ] 優先順位付けと改修計画
- [ ] 段階的リファクタリング実施

---

## 📚 関連文書
- [新エルダーズギルド サーバント基本設計方針](../technical/NEW_ELDERS_GUILD_SERVANT_DESIGN_PRINCIPLE.md)
- [Issue #309: 自動化品質パイプライン実装](automated-quality-pipeline-proposal.md)

---

## ✅ 受け入れ基準

1. **全新規サーバント**が設計原則に100%準拠
2. **コードレビュー**で原則遵守が確認される
3. **ハルシネーション発生**が測定可能なレベルで減少
4. **開発者**が原則を理解し適用できる

---

**作成者**: グランドエルダーmaru + クロードエルダー  
**作成日**: 2025年7月24日  
**優先度**: 最高（新エルダーズギルド基盤）  

*"One Servant, One Command - Simplicity is the ultimate sophistication"*